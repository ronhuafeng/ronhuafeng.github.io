<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>不是追风少年</title><link>https://blog.formalscience.com/</link><description>Recent content on 不是追风少年</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Fri, 29 Apr 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.formalscience.com/index.xml" rel="self" type="application/rss+xml"/><item><title>Encounter Kubernetes</title><link>https://blog.formalscience.com/drafts/encounter_kubernetes/</link><pubDate>Fri, 29 Apr 2022 00:00:00 +0000</pubDate><guid>https://blog.formalscience.com/drafts/encounter_kubernetes/</guid><description>不是追风少年 https://blog.formalscience.com/drafts/encounter_kubernetes/ -- https://blog.formalscience.com/drafts/encounter_kubernetes/ -</description></item><item><title>2020 生活规划</title><link>https://blog.formalscience.com/2020/01/01/2020-guidelines/</link><pubDate>Wed, 01 Jan 2020 00:00:00 +0000</pubDate><guid>https://blog.formalscience.com/2020/01/01/2020-guidelines/</guid><description>不是追风少年 https://blog.formalscience.com/2020/01/01/2020-guidelines/ -&lt;h2 id="指导原则">指导原则&lt;/h2>
&lt;p>适当精简，包括日常生活用品，生活中从事的事情，工作中要处理的事情，自己阅读、观影等时间话费，感情方面也是重要一环，把精力放在有价值的关系上。&lt;/p>
&lt;ul>
&lt;li>身体健康&lt;/li>
&lt;li>读书、读论文&lt;/li>
&lt;li>多游览各方&lt;/li>
&lt;li>创作（文学、摄影）&lt;/li>
&lt;/ul>
- https://blog.formalscience.com/2020/01/01/2020-guidelines/ -</description></item><item><title>爱丁堡租房</title><link>https://blog.formalscience.com/2019/09/24/2019-09-24-rent-in-edinburgh/</link><pubDate>Tue, 24 Sep 2019 00:00:00 +0000</pubDate><guid>https://blog.formalscience.com/2019/09/24/2019-09-24-rent-in-edinburgh/</guid><description>不是追风少年 https://blog.formalscience.com/2019/09/24/2019-09-24-rent-in-edinburgh/ -&lt;p>生活就是一场旅行，这算是一个重大决定。到爱丁堡工作已经一周，时差基本倒过来了。
第一周住在酒店，最紧迫的事情就是租房，因为后续用来发工资的银行卡、办理警察局的手续都需要一个租房地址。&lt;/p>
&lt;p>出国前了解过这边的租房市场，主要通过 Zoopla 或者 Rightmove 等软件。不过都是隔岸观火，还是要实地考察才靠谱。
这边看房不像国内有一个看房小哥，一下午能带你看十几套房子。
我在软件上看到想去瞧一下的房子，都是要打电话去预约、APP 内发消息等。
等收到电话回访或者邮件回复后，约定一个看房时间（viewing arrangement），然后去看房。
一般会有很多人一起看房，热门的房型可能会有十几人。不过中介机构也不会无限量地拉人看房，有时就告诉你没有看房名额了。
等看房满意后就可以邮件或者网站填写申请，如果房主（landlord）同意，那么就可以交定金成交了。&lt;/p>
&lt;p>房租一般根据地理位置、装修等价格会有一些差别。
本来最初的目标是租一个一人间，比较难租到。后来和同事商量后，租了一个两人间。&lt;/p>
&lt;p>听同事讲爱丁堡房产的租售比不错，也许可以考虑在这边投资一下房子。&lt;/p>
- https://blog.formalscience.com/2019/09/24/2019-09-24-rent-in-edinburgh/ -</description></item><item><title>To Bangkok</title><link>https://blog.formalscience.com/2019/02/17/2019-02-17_to_bangkok/</link><pubDate>Sun, 17 Feb 2019 00:00:00 +0000</pubDate><guid>https://blog.formalscience.com/2019/02/17/2019-02-17_to_bangkok/</guid><description>不是追风少年 https://blog.formalscience.com/2019/02/17/2019-02-17_to_bangkok/ -&lt;ul>
&lt;li>&lt;a href="#%E6%99%AE%E9%80%9A%E8%90%BD%E5%9C%B0%E7%AD%BE%E8%AF%81visa-on-arrival-voa">普通落地签证/Visa on Arrival (VOA)&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#%E8%90%BD%E5%9C%B0%E7%AD%BE%E9%9C%80%E8%A6%81%E7%9A%84%E6%9D%A1%E4%BB%B6">落地签需要的条件&lt;/a>&lt;/li>
&lt;li>&lt;a href="#%E7%AD%BE%E8%AF%81%E6%9C%89%E6%95%88%E6%9C%9F">签证有效期&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#%E7%94%B5%E5%AD%90%E8%90%BD%E5%9C%B0%E7%AD%BE%E8%AF%81e-visa-on-arrivale-voa">电子落地签证/E-Visa on Arrival(E-VOA)&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#%E5%AE%9E%E9%99%85%E6%93%8D%E4%BD%9C">实际操作&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#%E6%8D%A2%E6%B1%87">换汇&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#%E5%AE%9E%E9%99%85%E6%93%8D%E4%BD%9C-1">实际操作&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#%E5%AE%9E%E7%94%A8%E4%BF%A1%E6%81%AF">实用信息&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="普通落地签证visa-on-arrival-voa">普通落地签证/Visa on Arrival (VOA)&lt;/h2>
&lt;p>中国公民适用普通落地签政策，相关政策链接：&lt;/p>
&lt;blockquote>
&lt;p>&lt;a href="http://www.thaiembassy.com/thailand/visa-on-arrival.php">http://www.thaiembassy.com/thailand/visa-on-arrival.php&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;ol>
&lt;li>《申请表》(Application forVisa on Arrival)、1张白/蓝底4*6cm照片、15天内往返机票、有效期超过6个月的护照。(注：表格可下载并事先用英文填好;在泰如无联系人，可填写拟住酒店地址、电话)。&lt;/li>
&lt;li>签证申请费每人1000铢。现场拍照另交费。申请落地签时，需备1万铢、每个家庭2万铢或等值外币以证明旅游期间有经济能力。泰移民官将抽查。&lt;/li>
&lt;/ol>
&lt;h3 id="落地签需要的条件">落地签需要的条件&lt;/h3>
&lt;ul>
&lt;li>持有泰国政府批准国家的护照者。&lt;/li>
&lt;li>护照必须是真实的，不低于 30 天有效期。&lt;/li>
&lt;li>泰国旅游的期限不超过 15 天。&lt;/li>
&lt;li>有到达泰国时，不超过 15 天的回程机票。&lt;/li>
&lt;li>报实际和能查询的泰国地址。&lt;/li>
&lt;li>非佛历 2522 年的入境黑名单者&lt;/li>
&lt;li>签证费仅收泰铢（现金）/不可退款&lt;/li>
&lt;li>入境时个人必须随身携有外币不低于 10,000 泰铢， 家庭不低于 20,000 泰铢&lt;/li>
&lt;/ul>
&lt;p>参考：https://ask.qyer.com/question/788823.html&lt;/p>
&lt;p>另外，2019/01/14 到 2020/04/30 落地签时免费的。&lt;/p>
&lt;h3 id="签证有效期">签证有效期&lt;/h3>
&lt;p>落地签有效期15天(包括入境当天)，如为以旅游为目的则不可延期。离境时签证过期需向移民局缴纳罚款，1天500铢，最高不超2万铢。&lt;/p>
&lt;h2 id="电子落地签证e-visa-on-arrivale-voa">电子落地签证/E-Visa on Arrival(E-VOA)&lt;/h2>
&lt;p>根据实际经验，落地泰国后如果走普通落地签的通道，队伍比较长，特别是航班密集落地的时候。
还有一种可以在网上预先申请的电子落地签，较为方便。&lt;/p>
&lt;p>优点：&lt;/p>
&lt;ol>
&lt;li>仅需要护照信息&lt;/li>
&lt;li>不需要提供实体照片&lt;/li>
&lt;/ol>
&lt;p>费用：普通落地签费用 + 提供服务的公司的服务费用&lt;/p>
&lt;p>参考：&lt;/p>
&lt;ol>
&lt;li>&lt;a href="https://zhuanlan.zhihu.com/p/50974628">不排队，1分钟快速入境！泰国电子落地签证（EVOA）申请攻略&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://bbs.qyer.com/thread-3104742-1.html">不要办e-visa落地签，没有任何意义- 泰国- 论坛- 穷游网&lt;/a>&lt;/li>
&lt;/ol>
&lt;p>有两家公司可以提供这项服务：&lt;/p>
&lt;ol>
&lt;li>VFS Global: &lt;a href="http://www.evisathailand.com">http://www.evisathailand.com&lt;/a>
&lt;ul>
&lt;li>普通服务：525 THB&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>evisathailand: &lt;a href="https://thailandevoa.vfsevisa.com">https://thailandevoa.vfsevisa.com&lt;/a>
&lt;ul>
&lt;li>普通服务：600 THB&lt;/li>
&lt;li>快速服务（24 小时出结果）：2500 THB&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h3 id="实际操作">实际操作&lt;/h3>
&lt;p>使用 &lt;a href="https://thailandevoa.vfsevisa.com">https://thailandevoa.vfsevisa.com&lt;/a> 申请，交了普通服务费 600 THB 。&lt;/p>
&lt;h2 id="换汇">换汇&lt;/h2>
&lt;ol>
&lt;li>机场 ATM 每次要收 150B 手续费&lt;/li>
&lt;li>国内银行预约（https://ask.qyer.com/question/3452511.html）&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>国内一般只要提前一天预约就可以，不一定要本人换，其他人也可以帮你换，如果分行储备很充足，当天也可以换到，你试试不一定来不及吧&lt;/li>
&lt;li>机场也有换，就是汇率不是很划算，如果担心那边没人可以再出发的机场换，你早点到机场，先换一点够用就行，剩下你过了关再换。&lt;/li>
&lt;li>华夏银行卡 &lt;a href="http://wenzhang.16fan.com/a/98638.html">http://wenzhang.16fan.com/a/98638.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;ol start="3">
&lt;li>换汇处，之后去 super rich 换汇率最划算&lt;/li>
&lt;/ol>
&lt;h3 id="实际操作-1">实际操作&lt;/h3>
&lt;p>就在机场换了一点，汇率不太好。
同伴从其他地方换了泰铢使用，我主要负责各种信用卡付款，所以最后使用现金也不是太多。&lt;/p>
&lt;h2 id="实用信息">实用信息&lt;/h2>
&lt;ol>
&lt;li>VFS Global 和 evisathailand 是两个不同的电子落地签代办公司。这两家公司在素万那普机场有各自独立的窗口，在普通的落地签证队伍旁边。我深夜到达的时候人很少，只有几个人在电子落地签队伍，入关很快。&lt;/li>
&lt;li>VFS Global 最后打出来的纸上没有二维码，evisathailand 的有。&lt;/li>
&lt;li>入关只需要那张纸、护照和入境卡三样东西。&lt;/li>
&lt;li>Grab 很方便，到市区 300 多泰铢吧。&lt;/li>
&lt;li>中国银行长城 Visa 白金信用卡汇率还不错。&lt;/li>
&lt;li>不要尝试曼谷的中餐馆，贵而且不好吃。&lt;/li>
&lt;li>大皇宫人很多，暹罗博物馆还不错，学生 50 泰铢（英文学生证就可以），其他外国人 200 泰铢。&lt;/li>
&lt;/ol>
- https://blog.formalscience.com/2019/02/17/2019-02-17_to_bangkok/ -</description></item><item><title>Go to Rust （一）</title><link>https://blog.formalscience.com/2018/12/26/2018-12-26-go-to-rust/</link><pubDate>Wed, 26 Dec 2018 00:00:00 +0000</pubDate><guid>https://blog.formalscience.com/2018/12/26/2018-12-26-go-to-rust/</guid><description>不是追风少年 https://blog.formalscience.com/2018/12/26/2018-12-26-go-to-rust/ -&lt;p>这几天看了 Rust 文档，把一些概念整理一下。&lt;/p>
&lt;ul>
&lt;li>通过 &lt;code>cargo&lt;/code> 新建一个项目，然后去管理其生命流程，这种现代做法很方便。&lt;/li>
&lt;li>对于 &lt;code>statement&lt;/code> 和 &lt;code>expression&lt;/code> 的使用方式和 scheme 有些类似，可以返回最后一个 &lt;code>expression&lt;/code> 的值。&lt;/li>
&lt;li>可能返回错误的地方使用 &lt;code>Result&lt;/code> 类型，很类似 Haskell 的处理流程。&lt;/li>
&lt;li>模式匹配的方式很像 Ocaml 。&lt;/li>
&lt;li>ownership 机制很新颖，限制能够带来巨大的力量。让我想到了《全职猎人》中对某项能力增加限制条件可以增加这个能力的威力的设定。&lt;/li>
&lt;li>&lt;code>Option&lt;/code> 类型就是 Haskell 的 &lt;code>Maybe&lt;/code> 。&lt;/li>
&lt;li>generics 的设计不知道有没有参考 C++ 的 template 概念。&lt;/li>
&lt;/ul>
&lt;p>目前只看到文档的第 11 章，Rust 语言的很多概念都能够在其他语言找到对应，只有 ownership 机制是我第一次见到，觉得新颖有趣。&lt;/p>
- https://blog.formalscience.com/2018/12/26/2018-12-26-go-to-rust/ -</description></item><item><title>pip 离线安装包</title><link>https://blog.formalscience.com/2018/12/13/2018-12-13-pip-install-package-offline/</link><pubDate>Thu, 13 Dec 2018 00:00:00 +0000</pubDate><guid>https://blog.formalscience.com/2018/12/13/2018-12-13-pip-install-package-offline/</guid><description>不是追风少年 https://blog.formalscience.com/2018/12/13/2018-12-13-pip-install-package-offline/ -&lt;h2 id="1-使用场景">1. 使用场景&lt;/h2>
&lt;p>在没有网络的设备上使用 pip 安装包。下面以 &lt;code>sklearn&lt;/code> 包为例展示如何在没有网络的环境下安装包。&lt;/p>
&lt;h2 id="2-下载包到本地缓存">2. 下载包到本地缓存&lt;/h2>
&lt;p>首先进入一个目录，在这个例子里是 &lt;code>/Users/bef0rewind/Downloads/pip-tmp&lt;/code> 目录。&lt;/p>
&lt;pre tabindex="0">&lt;code>pip download sklearn
&lt;/code>&lt;/pre>&lt;p>我这里下载到了一个缓存目录 &lt;code>/Users/bef0rewind/Downloads/pip-tmp&lt;/code>，随便选一个就好。&lt;code>pip download&lt;/code> 只会下载对应的包，不会进行安装。&lt;/p>
&lt;p>此时使用，&lt;code>pip freeze&lt;/code> 可以看到已经安装的包，如果之前没有安装过 &lt;code>sklearn&lt;/code>，显示的列表里是没有这个包的。&lt;/p>
&lt;h2 id="3-断网安装">3. 断网安装&lt;/h2>
&lt;p>为了展示没有网络的情况下如何安装，我断开网络进行了验证。&lt;/p>
&lt;pre tabindex="0">&lt;code>pip install --no-index --find-links=/Users/bef0rewind/Downloads/pip-tmp sklearn
&lt;/code>&lt;/pre>&lt;p>其中 &lt;code>--find-links&lt;/code> 要 &lt;code>pip&lt;/code> 从指定的目录里寻找安装包。&lt;/p>
&lt;h2 id="4-其他">4. 其他&lt;/h2>
&lt;p>如果要用 Python3，而系统默认的版本是 Python 2，则可以将 &lt;code>pip&lt;/code> 命令换成 &lt;code>pip3&lt;/code>。&lt;/p>
- https://blog.formalscience.com/2018/12/13/2018-12-13-pip-install-package-offline/ -</description></item><item><title/><link>https://blog.formalscience.com/drafts/deeplearningnotes/</link><pubDate>Fri, 07 Dec 2018 00:00:00 +0000</pubDate><guid>https://blog.formalscience.com/drafts/deeplearningnotes/</guid><description>不是追风少年 https://blog.formalscience.com/drafts/deeplearningnotes/ -&lt;ol>
&lt;li>Learn similar words - unsupervised learning - similar words tend to occur in similar contexts&lt;/li>
&lt;li>word embeddings - word2vec - t-SNE&lt;/li>
&lt;li>semantic analogy, syntactic analogy&lt;/li>
&lt;/ol>
&lt;p>Python 3.7 is not supported by TF at 2018/12/07.&lt;br>
&lt;a href="https://pytorch.org/get-started/locally/">https://pytorch.org/get-started/locally/&lt;/a>&lt;br>
pip3 install torch torchvision&lt;/p>
&lt;p>Document oriented programming&lt;/p>
- https://blog.formalscience.com/drafts/deeplearningnotes/ -</description></item><item><title>还在下雨</title><link>https://blog.formalscience.com/2018/12/06/2018-12-06-%E8%BF%98%E5%9C%A8%E4%B8%8B%E9%9B%A8/</link><pubDate>Thu, 06 Dec 2018 00:00:00 +0000</pubDate><guid>https://blog.formalscience.com/2018/12/06/2018-12-06-%E8%BF%98%E5%9C%A8%E4%B8%8B%E9%9B%A8/</guid><description>不是追风少年 https://blog.formalscience.com/2018/12/06/2018-12-06-%E8%BF%98%E5%9C%A8%E4%B8%8B%E9%9B%A8/ -&lt;p>早上闹钟还没响，就收到学弟从美东发来的微信消息，高管在加拿大被扣留，感觉刚释放的贸易战缓和信号瞬间消失无影。接着看到同学发送的新闻，张首晟教授去世，又给学弟把这则消息转了过去。&lt;/p>
&lt;p>到了公司也没获得更多信息。一天工作下来，解决了几个问题，心情是近来最平静的一天。雨一直下个不停，沿着玻璃幕墙下来，汇成一条条水线流下。&lt;/p>
&lt;p>各类信息媒介上也是消息攒动，同样没获得更多有效信息。前段时间看到一个问题：为什么感觉今年逝去的名人特别多？我想，也许是他们的时代逝去了，也许是我们的时代逝去了。&lt;/p>
&lt;p>小学、初中、高中的时候喜欢数学和诗歌。现在对一些人向往的“诗意的栖居”这种描述不怎么向往了。在这个世界，不可能所有人都能到达那种美好的彼岸。现实还是要战斗，在枪炮中让玫瑰绽放。&lt;/p>
&lt;p>有观点说外面的世界再乱，只要自己的小环境能保持美好就够了。我也不知道要怎么选择，一是我不知道什么叫好的小环境，而是我可能也没能力隔绝外界的干扰，也就无所谓选择。&lt;/p>
&lt;p>晚上从公司回来，雨还是在下，风吹在手上冻得不行。&lt;/p>
&lt;p>寒冷 / 困顿 / 饥饿&lt;br>
树影 / 摇曳 / 零落&lt;br>
混乱 / 猜测 / 迷惑&lt;br>
启程 / 归来 / 此刻&lt;/p>
- https://blog.formalscience.com/2018/12/06/2018-12-06-%E8%BF%98%E5%9C%A8%E4%B8%8B%E9%9B%A8/ -</description></item><item><title>Escape from escape analysis</title><link>https://blog.formalscience.com/2018/11/30/2018-11-30-escape-from-escape-analysis/</link><pubDate>Fri, 30 Nov 2018 00:00:00 +0000</pubDate><guid>https://blog.formalscience.com/2018/11/30/2018-11-30-escape-from-escape-analysis/</guid><description>不是追风少年 https://blog.formalscience.com/2018/11/30/2018-11-30-escape-from-escape-analysis/ -&lt;h2 id="1-逃逸分析背景">1. 逃逸分析背景&lt;/h2>
&lt;p>Go 语言采用了并发的（Concurrent）、非移动的（Non-Movable）、非分代的（Non-Generational）、基于三色（Tri-color）标记的垃圾回收（Garbage Collection）算法，只在 特定阶段开启写屏障（write barrier）。
特点是全局停顿时间比较少，在一些场景下是十微秒级别的。&lt;/p>
&lt;p>垃圾回收算法针对的是堆（heap）中的内存。
为了减少垃圾回收的时间消耗，Go 语言在编译阶段通过静态分析算法对程序的结构进行分析，尽可能讲对象分配在栈上（如果这个对象的生命周期在它定义的函数返回时就结束的话）。
这一算法也利用了 Go 语言在函数传递参数时总是传递参数的值这一个语言特性。&lt;/p>
&lt;p>而静态分析不总是完备的，会有一些本来可以分配在栈上的对象被 Go 的编译器分配在了堆上。
如这篇文章《&lt;a href="http://www.agardner.me/golang/garbage/collection/gc/escape/analysis/2015/10/18/go-escape-analysis.html">Golang escape analysis&lt;/a>》所描述的一些例子一样，有些对象本来可以避免逃逸（Escape，指的是对象被分配在堆上）。&lt;/p>
&lt;p>对于某些场景，我们确定一个对象肯定可以（也应当）被分配在栈上，但是它却逃逸了。
这样在某些关键路径上的逃逸的对象会造成大量的分配和垃圾回收。&lt;/p>
&lt;h2 id="2-go-版本">2. Go 版本&lt;/h2>
&lt;p>使用的 Go 版本为今晚刚从 master 分支上 pull 下的源码直接构建。&lt;/p>
&lt;pre tabindex="0">&lt;code>ThinkPad-X1-Carbon:bin bef0rewind$ ./go version
go version devel +42e8b9c3a4 Fri Nov 30 15:17:34 2018 +0000 darwin/amd64
&lt;/code>&lt;/pre>&lt;h2 id="3-示例">3. 示例&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// file: escape.go
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#e6db74">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">BigTempObject&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">field1&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">causeEscape&lt;/span>(&lt;span style="color:#a6e22e">i&lt;/span> &lt;span style="color:#66d9ef">interface&lt;/span>{}) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span> &lt;span style="color:#a6e22e">i&lt;/span>.(&lt;span style="color:#66d9ef">type&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">BigTempObject&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> println(&lt;span style="color:#a6e22e">i&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Println&lt;/span>(&lt;span style="color:#a6e22e">i&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">obj&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">BigTempObject&lt;/span>{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">addrObj&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">obj&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">causeEscape&lt;/span>(&lt;span style="color:#a6e22e">addrObj&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>使用 &lt;code>go run -gcflags=&amp;quot;-m -m&amp;quot; escape.go&lt;/code> 可以在运行时输出逃逸分析的结果。&lt;/p>
&lt;pre tabindex="0">&lt;code>./escape.go:10: cannot inline causeEscape: unhandled op TYPESW
./escape.go:19: cannot inline main: non-leaf function
./escape.go:10: leaking param: i
./escape.go:10: from ... argument (arg to ...) at ./escape.go:15
./escape.go:10: from *(... argument) (indirection) at ./escape.go:15
./escape.go:10: from ... argument (passed to call[argument content escapes]) at ./escape.go:15
./escape.go:15: causeEscape ... argument does not escape
./escape.go:23: addrObj escapes to heap
./escape.go:23: from addrObj (passed to call[argument escapes]) at ./escape.go:23
./escape.go:21: &amp;amp;obj escapes to heap
./escape.go:21: from addrObj (assigned) at ./escape.go:21
./escape.go:21: from addrObj (interface-converted) at ./escape.go:23
./escape.go:21: from addrObj (passed to call[argument escapes]) at ./escape.go:23
./escape.go:20: moved to heap: obj
(0x10904e0,0xc420080050)
&lt;/code>&lt;/pre>&lt;p>&lt;code>obj&lt;/code> 可以分配在栈上，因为在 &lt;code>main&lt;/code> 函数返回时（栈退出），这个变量占用的空间就可以安全被用在其他地方了。
但是 “./escape.go:20: moved to heap: obj” 说明 &lt;code>obj&lt;/code> 被分配在了堆上。&lt;/p>
&lt;h2 id="4-小技巧">4. 小技巧&lt;/h2>
&lt;p>如何改变这个分析结果，需要一点小技巧。&lt;/p>
&lt;p>关键词是 &lt;code>uintptr&lt;/code> 类型。
Go 语言中对 &lt;code>uintptr&lt;/code> 是这样描述的：&lt;/p>
&lt;blockquote>
&lt;p>uintptr is an integer type that is large enough to hold the bit pattern of any pointer.&lt;/p>
&lt;/blockquote>
&lt;p>比如在 64-bit Linux 系统上 &lt;code>uintptr&lt;/code> 被定义成为了 &lt;code>uint64&lt;/code>。
Go 中合法的类型转换为：&lt;code>normal pointer&lt;/code> ⟷ &lt;code>unsafe.Pointer&lt;/code> ⟷ &lt;code>uintptr&lt;/code> 。
因此我们可以把上面的程序中的 &lt;code>addrObj&lt;/code> 转换为 &lt;code>uintptr&lt;/code>。
这样 Go 编译器不再认为 &lt;code>addrObj&lt;/code> 同后面函数 &lt;code>causeEscape&lt;/code> 使用的参数 &lt;code>i&lt;/code> 存在引用关系，从而绕过 Escape Analysis Algorithm 。
为了防止垃圾回收过程中 &lt;code>obj&lt;/code> 被回收，可以使用 &lt;code>obj.field1 = 0&lt;/code> 来保持 &lt;code>obj&lt;/code> 活跃。&lt;/p>
&lt;p>修改后的代码如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;unsafe&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">BigTempObject&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">field1&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">causeEscape&lt;/span>(&lt;span style="color:#a6e22e">i&lt;/span> &lt;span style="color:#66d9ef">interface&lt;/span>{}) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span> &lt;span style="color:#a6e22e">i&lt;/span>.(&lt;span style="color:#66d9ef">type&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">BigTempObject&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> println(&lt;span style="color:#a6e22e">i&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Println&lt;/span>(&lt;span style="color:#a6e22e">i&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">obj&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">BigTempObject&lt;/span>{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">addrObj&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">obj&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">intAddr&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> uintptr(&lt;span style="color:#a6e22e">unsafe&lt;/span>.&lt;span style="color:#a6e22e">Pointer&lt;/span>(&lt;span style="color:#a6e22e">addrObj&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">causeEscape&lt;/span>((&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">BigTempObject&lt;/span>)(&lt;span style="color:#a6e22e">unsafe&lt;/span>.&lt;span style="color:#a6e22e">Pointer&lt;/span>(&lt;span style="color:#a6e22e">intAddr&lt;/span>)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">obj&lt;/span>.&lt;span style="color:#a6e22e">field1&lt;/span> = &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>使用 &lt;code>go run -gcflags=&amp;quot;-m -m&amp;quot; escape.go&lt;/code> 运行结果：&lt;/p>
&lt;pre tabindex="0">&lt;code>./escape.go:13: cannot inline causeEscape: unhandled op TYPESW
./escape.go:22: cannot inline main: non-leaf function
./escape.go:13: leaking param: i
./escape.go:13: from ... argument (arg to ...) at ./escape.go:18
./escape.go:13: from *(... argument) (indirection) at ./escape.go:18
./escape.go:13: from ... argument (passed to call[argument content escapes]) at ./escape.go:18
./escape.go:18: causeEscape ... argument does not escape
./escape.go:26: (*BigTempObject)(unsafe.Pointer(intAddr)) escapes to heap
./escape.go:26: from (*BigTempObject)(unsafe.Pointer(intAddr)) (passed to call[argument escapes]) at ./escape.go:26
./escape.go:24: main &amp;amp;obj does not escape
(0x10904e0,0xc42003bf70)
&lt;/code>&lt;/pre>&lt;p>可以看到 &lt;code>obj&lt;/code> 不再逃逸，主要是 &lt;code>intAddr&lt;/code> 中断了逃逸分析算法构建的指针依赖关系（表示为一个有向图）。&lt;/p>
&lt;h2 id="5-一点感想">5. 一点感想&lt;/h2>
&lt;p>我们可以做到不代表一定去做，有风险也不代表禁区，采取什么样的行动是个人权衡后的选择。&lt;br>
什么原因导致了人们做了不同的选择，而人们不同的选择又导致了什么结果？&lt;br>
多样性是这个世界的现状，黑暗面与光明面同在。
May the force be with you.&lt;/p>
- https://blog.formalscience.com/2018/11/30/2018-11-30-escape-from-escape-analysis/ -</description></item><item><title>Golang Receiver Type 探索</title><link>https://blog.formalscience.com/2018/11/21/2018-11-21-golang-receiver-type/</link><pubDate>Wed, 21 Nov 2018 00:00:00 +0000</pubDate><guid>https://blog.formalscience.com/2018/11/21/2018-11-21-golang-receiver-type/</guid><description>不是追风少年 https://blog.formalscience.com/2018/11/21/2018-11-21-golang-receiver-type/ -&lt;h2 id="1-参考">1. 参考&lt;/h2>
&lt;p>在 Go 的官方 spec 中有以下涉及到类型和方法的章节，如果需要了解具体的细节，可以参考阅读。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://golang.google.cn/ref/spec#Method_sets">https://golang.google.cn/ref/spec#Method_sets&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://golang.google.cn/ref/spec#Types">https://golang.google.cn/ref/spec#Types&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://golang.google.cn/ref/spec#Struct_types">https://golang.google.cn/ref/spec#Struct_types&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://golang.google.cn/ref/spec#Composite_literals">https://golang.google.cn/ref/spec#Composite_literals&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>核心的概念是 method sets：&lt;/p>
&lt;blockquote>
&lt;p>A type may have a method set associated with it. The method set of an interface type is its interface. The method set of any other type T consists of all methods declared with receiver type T. The method set of the corresponding pointer type *T is the set of all methods declared with receiver *T or T (that is, it also contains the method set of T). Further rules apply to structs containing embedded fields, as described in the section on struct types. Any other type has an empty method set. In a method set, each method must have a unique non-blank method name.&lt;/p>
&lt;p>The method set of a type determines the interfaces that the type implements and the methods that can be called using a receiver of that type.&lt;/p>
&lt;/blockquote>
&lt;p>下面的一些细节基本上都和这段描述相关。&lt;/p>
&lt;h2 id="2-duck-typing-与方法调用">2. Duck typing 与方法调用&lt;/h2>
&lt;p>在很多面向对象的语言中，一个对象都可以“拥有”一些方法，使用例如 &lt;code>obj.f(a, b, c)&lt;/code> 的形式进行调用。结合语言的类型系统，通过“扩展”、“继承”、“实现”等术语，我们可以将不同的类组织起来。在 Go 语言中采用的是 “duck typing”，没有显式的类型关系定义关键字。当一个类型实现了一个接口的全部方法时，那这个类型就被视为实现了这个接口。&lt;/p>
&lt;p>例如：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#e6db74">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Duck&lt;/span> &lt;span style="color:#66d9ef">interface&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Bark&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">A&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">B&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">A&lt;/span>) &lt;span style="color:#a6e22e">Bark&lt;/span>() {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">iA&lt;/span> &lt;span style="color:#66d9ef">interface&lt;/span>{} = &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">A&lt;/span>{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">ok&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> (&lt;span style="color:#a6e22e">iA&lt;/span>).(&lt;span style="color:#a6e22e">Duck&lt;/span>); &lt;span style="color:#a6e22e">ok&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;&amp;amp;A{} is Duck&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;&amp;amp;A{} is not Duck&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">iB&lt;/span> &lt;span style="color:#66d9ef">interface&lt;/span>{} = &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">B&lt;/span>{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">ok&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> (&lt;span style="color:#a6e22e">iB&lt;/span>).(&lt;span style="color:#a6e22e">Duck&lt;/span>); &lt;span style="color:#a6e22e">ok&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;&amp;amp;B{} is Duck&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fmt&lt;/span>.&lt;span style="color:#a6e22e">Println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;&amp;amp;B{} is not Duck&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>&amp;amp;A{} is Duck
&amp;amp;B{} is not Duck
&lt;/code>&lt;/pre>&lt;p>我们可以用原始的类型去调用一个方法，也可以使用一个接口去调用方法。这里就涉及到方法调用者的问题：什么样的对象是一个合法的方法调用者？&lt;/p>
&lt;p>至少 &lt;code>A{}&lt;/code> 不是，因为我们实现 &lt;code>Duck&lt;/code> 接口的时候，使用的是 &lt;code>func (*A) Bark()&lt;/code> 进行的定义，而非 &lt;code>func (A) Bark()&lt;/code>。这样就导致了只有 &lt;code>A&lt;/code> 类型对象的指针类型才能作为方法调用者去调用 &lt;code>Bark&lt;/code> 方法。&lt;/p>
&lt;h2 id="3-成员函数的参数">3. 成员函数的参数&lt;/h2>
&lt;p>在实现中，调用某个类型的成员方法，第一个参数其实是这个方法的实现对象自身，即如果是一个指针的方法，就是这个指针的值，如果是一个对象，就是这个对象的值。&lt;/p>
&lt;p>下面使用 Go 1.8.3 展示，因为当前最新的 Go 编译器在打印 stack trace 的时候不再打印函数的参数（这个例子中）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">R1&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">n&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">R1&lt;/span>) &lt;span style="color:#a6e22e">f&lt;/span>(&lt;span style="color:#a6e22e">n&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> println(&lt;span style="color:#e6db74">&amp;#34;received&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">n&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> panic(&lt;span style="color:#e6db74">&amp;#34;just a panic&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">R1&lt;/span>{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">a&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> println(&lt;span style="color:#a6e22e">r&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">f&lt;/span>(&lt;span style="color:#a6e22e">a&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>0xc420039f70
received 1
panic: just a panic
goroutine 1 [running]:
main.(*R1).f(0xc420039f70, 0x1)
/Users/bef0rewind/Projects/net example/src/main/receiver_type.go:9 +0xa3
main.main()
/Users/bef0rewind/Projects/net example/src/main/receiver_type.go:16 +0x5a
&lt;/code>&lt;/pre>&lt;p>Stack trace 中函数 &lt;code>f&lt;/code> 第一个值是指针 &lt;code>r&lt;/code> 的值。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">R1&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">n&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">m&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">R1&lt;/span>) &lt;span style="color:#a6e22e">f&lt;/span>(&lt;span style="color:#a6e22e">n&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> println(&lt;span style="color:#e6db74">&amp;#34;received&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">n&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> panic(&lt;span style="color:#e6db74">&amp;#34;just a panic&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#a6e22e">R1&lt;/span>) &lt;span style="color:#a6e22e">g&lt;/span>(&lt;span style="color:#a6e22e">n&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> println(&lt;span style="color:#e6db74">&amp;#34;received&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">n&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> panic(&lt;span style="color:#e6db74">&amp;#34;just a panic&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">r&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">R1&lt;/span>{&lt;span style="color:#ae81ff">7&lt;/span>, &lt;span style="color:#ae81ff">9&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">a&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> println(&lt;span style="color:#a6e22e">r&lt;/span>.&lt;span style="color:#a6e22e">n&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#a6e22e">r&lt;/span>).&lt;span style="color:#a6e22e">g&lt;/span>(&lt;span style="color:#a6e22e">a&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>7
received 1
panic: just a panic
goroutine 1 [running]:
main.R1.g(0x7, 0x9, 0x1)
/Users/bef0rewind/Projects/net example/src/receiver_type/main/args.go:15 +0xa3
main.main()
/Users/bef0rewind/Projects/net example/src/receiver_type/main/args.go:22 +0x58
&lt;/code>&lt;/pre>&lt;p>Stack trace 中函数 &lt;code>g&lt;/code> 第一个值是 &lt;code>r&lt;/code> 的值 &lt;code>7&lt;/code> 和 &lt;code>9&lt;/code>。&lt;/p>
&lt;p>从这个实现方式中我们可以推断以下几点：&lt;/p>
&lt;ul>
&lt;li>Go 语言采用参数传值的方式进行函数调用，因此如果对象很大，使用的对象本身调用函数会带来大量的复制&lt;/li>
&lt;li>不可能在函数调用中改变函数外的调用者，因为传到函数内部的只是调用者的副本&lt;/li>
&lt;/ul>
&lt;h2 id="4-使用接口调用函数">4. 使用接口调用函数&lt;/h2>
&lt;p>基于这样的成员函数实现方式，我们可以尝试另外一种调用方式：使用接口类型调用一个函数。
这里不是将一个对象转换成特定的接口然后去调用函数，而是使用接口类型本身去进行函数调用。
这种方式在 Go 1.9 中开始支持，在 Go 1.10 开始写入 Go 的 specs。这个例子使用的是 Go master 分支的版本，可能是 Go 1.11。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">M&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">M&lt;/span>) &lt;span style="color:#a6e22e">f&lt;/span>(&lt;span style="color:#a6e22e">n&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> println(&lt;span style="color:#e6db74">&amp;#34;I;m M, with&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">n&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">IM&lt;/span> &lt;span style="color:#66d9ef">interface&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">f&lt;/span>(&lt;span style="color:#a6e22e">n&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">m&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">M&lt;/span>{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">IM&lt;/span>.&lt;span style="color:#a6e22e">f&lt;/span>(&lt;span style="color:#a6e22e">m&lt;/span>, &lt;span style="color:#ae81ff">7&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>I;m M, with 7
&lt;/code>&lt;/pre>&lt;p>此外还能使用匿名接口类型去调用函数，例如：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">M&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">M&lt;/span>) &lt;span style="color:#a6e22e">f&lt;/span>(&lt;span style="color:#a6e22e">n&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> println(&lt;span style="color:#e6db74">&amp;#34;I;m M, with&amp;#34;&lt;/span>, &lt;span style="color:#a6e22e">n&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">m&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">M&lt;/span>{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">interface&lt;/span>{&lt;span style="color:#a6e22e">f&lt;/span>(&lt;span style="color:#a6e22e">n&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>)}.&lt;span style="color:#a6e22e">f&lt;/span>(&lt;span style="color:#a6e22e">m&lt;/span>, &lt;span style="color:#ae81ff">7&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>运行结果与上面的一段采用 &lt;code>IM&lt;/code> 接口定义的例子是一样的。&lt;/p>
&lt;h2 id="5-注入依赖">5. 注入依赖&lt;/h2>
&lt;p>有时候一个对象在实例化的时候，它的一些成员方法的行为可能还没有确定，需要依赖外界注入。此时我们可以在对象类型定义中内嵌一个接口，然后在后期传入一个接口的实例来确定其行为。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">BinaryOp&lt;/span> &lt;span style="color:#66d9ef">interface&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">Compute&lt;/span>(&lt;span style="color:#a6e22e">a&lt;/span>, &lt;span style="color:#a6e22e">b&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>) &lt;span style="color:#66d9ef">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">ComputeNode&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">x&lt;/span>, &lt;span style="color:#a6e22e">y&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">BinaryOp&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#a6e22e">node&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">ComputeNode&lt;/span>) &lt;span style="color:#a6e22e">Result&lt;/span>() &lt;span style="color:#66d9ef">int&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">node&lt;/span>.&lt;span style="color:#a6e22e">BinaryOp&lt;/span>.&lt;span style="color:#a6e22e">Compute&lt;/span>(&lt;span style="color:#a6e22e">node&lt;/span>.&lt;span style="color:#a6e22e">x&lt;/span>, &lt;span style="color:#a6e22e">node&lt;/span>.&lt;span style="color:#a6e22e">y&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Add&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Add&lt;/span>) &lt;span style="color:#a6e22e">Compute&lt;/span>(&lt;span style="color:#a6e22e">a&lt;/span>, &lt;span style="color:#a6e22e">b&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>) &lt;span style="color:#66d9ef">int&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">a&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#a6e22e">b&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">type&lt;/span> &lt;span style="color:#a6e22e">Multi&lt;/span> &lt;span style="color:#66d9ef">struct&lt;/span> {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> (&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#a6e22e">Multi&lt;/span>) &lt;span style="color:#a6e22e">Compute&lt;/span>(&lt;span style="color:#a6e22e">a&lt;/span>, &lt;span style="color:#a6e22e">b&lt;/span> &lt;span style="color:#66d9ef">int&lt;/span>) &lt;span style="color:#66d9ef">int&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">a&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#a6e22e">b&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">node&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">ComputeNode&lt;/span>{&lt;span style="color:#a6e22e">x&lt;/span>:&lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#a6e22e">y&lt;/span>:&lt;span style="color:#ae81ff">3&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">node&lt;/span>.&lt;span style="color:#a6e22e">BinaryOp&lt;/span> = &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">Add&lt;/span>{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> println(&lt;span style="color:#a6e22e">node&lt;/span>.&lt;span style="color:#a6e22e">Result&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">node&lt;/span>.&lt;span style="color:#a6e22e">BinaryOp&lt;/span> = &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">Multi&lt;/span>{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> println(&lt;span style="color:#a6e22e">node&lt;/span>.&lt;span style="color:#a6e22e">Result&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>5
6
&lt;/code>&lt;/pre>&lt;p>注意一定要记得传入接口的实例，在这个例子中如果不给 &lt;code>node&lt;/code> 传入一个 &lt;code>BinaryOp&lt;/code> 接口实例，那 &lt;code>node.BinaryOp&lt;/code> 是 &lt;code>nil&lt;/code>，在调用 &lt;code>Compute&lt;/code> 方法的时候就会发生异常。例如将上面的 &lt;code>main&lt;/code> 函数稍作修改：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">node&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#a6e22e">ComputeNode&lt;/span>{&lt;span style="color:#a6e22e">x&lt;/span>:&lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#a6e22e">y&lt;/span>:&lt;span style="color:#ae81ff">3&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//node.BinaryOp = &amp;amp;Add{}
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> println(&lt;span style="color:#a6e22e">node&lt;/span>.&lt;span style="color:#a6e22e">Result&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x104d8d7]
goroutine 1 [running]:
main.(*ComputeNode).Result(...)
/Users/bef0rewind/Projects/net example/src/receiver_type/main/injection.go:13
main.main()
/Users/bef0rewind/Projects/net example/src/receiver_type/main/injection.go:32 +0x47
&lt;/code>&lt;/pre>&lt;h2 id="6-内部机制">6. 内部机制&lt;/h2>
&lt;p>内部机制有一些细节。大体就是一个接口 &lt;code>i&lt;/code> 包含两部分内容（指针），一个是接口代表的方法的集合，一个实现这个接口的具体对象；而一个对象 &lt;code>obj&lt;/code>，它包含了自己的内存中的值，也能通过其类型获取到 &lt;code>obj&lt;/code> 实现的方法集合。&lt;/p>
&lt;p>将这两个概念记住，在实现一些模式的时候就会少很多心智负担。&lt;/p>
&lt;h2 id="7-总结">7. 总结&lt;/h2>
&lt;p>Go 语言的这套基于 “duck typing” 的机制好不好，争论有很多。不过我一向对这些争论没有特别的倾向，至少理解其机制之后按照其设计思路来用还可以正常使用，而且里面没有复杂的概念和例外情形。&lt;/p>
&lt;p>也许我的理解有偏差，但现在还没有发现什么矛盾的地方。&lt;/p>
- https://blog.formalscience.com/2018/11/21/2018-11-21-golang-receiver-type/ -</description></item></channel></rss>