<!doctype html><html lang=zh-cn><head><title>Golang Receiver Type æ¢ç´¢ // ä¸æ˜¯è¿½é£å°‘å¹´</title><link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.104.3"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="bef0rewind"><meta name=description content><link rel=stylesheet href=https://blog.formalscience.com/css/main.min.7399fa7ec2205ae468fae43bdd5857841a2cd7eb35f0c8562b0e111b9d44c95f.css><link rel=stylesheet href=/css/style.css><script src=/javascripts/audio-player.js></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Golang Receiver Type æ¢ç´¢"><meta name=twitter:description content="1. å‚è€ƒ åœ¨ Go çš„å®˜æ–¹ spec ä¸­æœ‰ä»¥ä¸‹æ¶‰åŠåˆ°ç±»å‹å’Œæ–¹æ³•çš„ç« èŠ‚ï¼Œå¦‚æœéœ€è¦äº†è§£å…·ä½“çš„ç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒé˜…è¯»ã€‚
https://golang.google.cn/ref/spec#Method_sets https://golang.google.cn/ref/spec#Types https://golang.google.cn/ref/spec#Struct_types https://golang.google.cn/ref/spec#Composite_literals æ ¸å¿ƒçš„æ¦‚å¿µæ˜¯ method setsï¼š
A type may have a method set associated with it. The method set of an interface type is its interface. The method set of any other type T consists of all methods declared with receiver type T. The method set of the corresponding pointer type *T is the set of all methods declared with receiver *T or T (that is, it also contains the method set of T)."><meta property="og:title" content="Golang Receiver Type æ¢ç´¢"><meta property="og:description" content="1. å‚è€ƒ åœ¨ Go çš„å®˜æ–¹ spec ä¸­æœ‰ä»¥ä¸‹æ¶‰åŠåˆ°ç±»å‹å’Œæ–¹æ³•çš„ç« èŠ‚ï¼Œå¦‚æœéœ€è¦äº†è§£å…·ä½“çš„ç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒé˜…è¯»ã€‚
https://golang.google.cn/ref/spec#Method_sets https://golang.google.cn/ref/spec#Types https://golang.google.cn/ref/spec#Struct_types https://golang.google.cn/ref/spec#Composite_literals æ ¸å¿ƒçš„æ¦‚å¿µæ˜¯ method setsï¼š
A type may have a method set associated with it. The method set of an interface type is its interface. The method set of any other type T consists of all methods declared with receiver type T. The method set of the corresponding pointer type *T is the set of all methods declared with receiver *T or T (that is, it also contains the method set of T)."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.formalscience.com/2018/11/21/2018-11-21-golang-receiver-type/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-11-21T00:00:00+00:00"><meta property="article:modified_time" content="2018-11-21T00:00:00+00:00"></head><body><header class=app-header><a href=https://blog.formalscience.com/><img class=app-header-avatar src=/avatar.jpg alt=bef0rewind></a>
<span class=app-header-title>ä¸æ˜¯è¿½é£å°‘å¹´</span><nav class=app-header-menu><a class=app-header-menu-item href=/>Home</a>
ğŸ˜Š<br><a class=app-header-menu-item href=/posts>Blogs</a>
ğŸ˜Š<br><a class=app-header-menu-item href=/douban>è±†ç“£æ–‡ç« å¤‡ä»½</a>
ğŸ˜Š<br><a class=app-header-menu-item href=/wechat-blogs>å¾®ä¿¡å…¬ä¼—å·</a>
ğŸ˜Š<br><a class=app-header-menu-item href=/categories/>Categories</a>
ğŸ˜Š<br><a class=app-header-menu-item href=/tags/>Tags</a>
ğŸ˜Š<br><a class=app-header-menu-item href=/about/>About</a>
ğŸ˜Š<br><a class=app-header-menu-item href=/feed.xml>RSS</a></nav><p>å½“ä½ åœ¨è¿½ç€é£ï¼Œé£ä¹Ÿåœ¨æ¨ç€ä½ </p><div class=app-header-social><a href=https://github.com/ronhuafeng target=_blank rel="noreferrer noopener me"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>æˆ‘çš„ GitHub</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>Golang Receiver Type æ¢ç´¢</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Nov 21, 2018</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>4 min read</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg><a class=tag href=https://blog.formalscience.com/tags/golang/>Golang</a></div></div></header><div class=post-content><h2 id=1-å‚è€ƒ>1. å‚è€ƒ</h2><p>åœ¨ Go çš„å®˜æ–¹ spec ä¸­æœ‰ä»¥ä¸‹æ¶‰åŠåˆ°ç±»å‹å’Œæ–¹æ³•çš„ç« èŠ‚ï¼Œå¦‚æœéœ€è¦äº†è§£å…·ä½“çš„ç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒé˜…è¯»ã€‚</p><ul><li><a href=https://golang.google.cn/ref/spec#Method_sets>https://golang.google.cn/ref/spec#Method_sets</a></li><li><a href=https://golang.google.cn/ref/spec#Types>https://golang.google.cn/ref/spec#Types</a></li><li><a href=https://golang.google.cn/ref/spec#Struct_types>https://golang.google.cn/ref/spec#Struct_types</a></li><li><a href=https://golang.google.cn/ref/spec#Composite_literals>https://golang.google.cn/ref/spec#Composite_literals</a></li></ul><p>æ ¸å¿ƒçš„æ¦‚å¿µæ˜¯ method setsï¼š</p><blockquote><p>A type may have a method set associated with it. The method set of an interface type is its interface. The method set of any other type T consists of all methods declared with receiver type T. The method set of the corresponding pointer type *T is the set of all methods declared with receiver *T or T (that is, it also contains the method set of T). Further rules apply to structs containing embedded fields, as described in the section on struct types. Any other type has an empty method set. In a method set, each method must have a unique non-blank method name.</p><p>The method set of a type determines the interfaces that the type implements and the methods that can be called using a receiver of that type.</p></blockquote><p>ä¸‹é¢çš„ä¸€äº›ç»†èŠ‚åŸºæœ¬ä¸Šéƒ½å’Œè¿™æ®µæè¿°ç›¸å…³ã€‚</p><h2 id=2-duck-typing-ä¸æ–¹æ³•è°ƒç”¨>2. Duck typing ä¸æ–¹æ³•è°ƒç”¨</h2><p>åœ¨å¾ˆå¤šé¢å‘å¯¹è±¡çš„è¯­è¨€ä¸­ï¼Œä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥â€œæ‹¥æœ‰â€ä¸€äº›æ–¹æ³•ï¼Œä½¿ç”¨ä¾‹å¦‚ <code>obj.f(a, b, c)</code> çš„å½¢å¼è¿›è¡Œè°ƒç”¨ã€‚ç»“åˆè¯­è¨€çš„ç±»å‹ç³»ç»Ÿï¼Œé€šè¿‡â€œæ‰©å±•â€ã€â€œç»§æ‰¿â€ã€â€œå®ç°â€ç­‰æœ¯è¯­ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸åŒçš„ç±»ç»„ç»‡èµ·æ¥ã€‚åœ¨ Go è¯­è¨€ä¸­é‡‡ç”¨çš„æ˜¯ â€œduck typingâ€ï¼Œæ²¡æœ‰æ˜¾å¼çš„ç±»å‹å…³ç³»å®šä¹‰å…³é”®å­—ã€‚å½“ä¸€ä¸ªç±»å‹å®ç°äº†ä¸€ä¸ªæ¥å£çš„å…¨éƒ¨æ–¹æ³•æ—¶ï¼Œé‚£è¿™ä¸ªç±»å‹å°±è¢«è§†ä¸ºå®ç°äº†è¿™ä¸ªæ¥å£ã€‚</p><p>ä¾‹å¦‚ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Duck</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>Bark</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>A</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>B</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=o>*</span><span class=nx>A</span><span class=p>)</span> <span class=nf>Bark</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>iA</span> <span class=kd>interface</span><span class=p>{}</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>A</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=p>(</span><span class=nx>iA</span><span class=p>).(</span><span class=nx>Duck</span><span class=p>);</span> <span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;&amp;A{} is Duck&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;&amp;A{} is not Duck&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>iB</span> <span class=kd>interface</span><span class=p>{}</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>B</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=p>(</span><span class=nx>iB</span><span class=p>).(</span><span class=nx>Duck</span><span class=p>);</span> <span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;&amp;B{} is Duck&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;&amp;B{} is not Duck&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><pre tabindex=0><code>&amp;A{} is Duck
&amp;B{} is not Duck
</code></pre><p>æˆ‘ä»¬å¯ä»¥ç”¨åŸå§‹çš„ç±»å‹å»è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ¥å£å»è°ƒç”¨æ–¹æ³•ã€‚è¿™é‡Œå°±æ¶‰åŠåˆ°æ–¹æ³•è°ƒç”¨è€…çš„é—®é¢˜ï¼šä»€ä¹ˆæ ·çš„å¯¹è±¡æ˜¯ä¸€ä¸ªåˆæ³•çš„æ–¹æ³•è°ƒç”¨è€…ï¼Ÿ</p><p>è‡³å°‘ <code>A{}</code> ä¸æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬å®ç° <code>Duck</code> æ¥å£çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯ <code>func (*A) Bark()</code> è¿›è¡Œçš„å®šä¹‰ï¼Œè€Œé <code>func (A) Bark()</code>ã€‚è¿™æ ·å°±å¯¼è‡´äº†åªæœ‰ <code>A</code> ç±»å‹å¯¹è±¡çš„æŒ‡é’ˆç±»å‹æ‰èƒ½ä½œä¸ºæ–¹æ³•è°ƒç”¨è€…å»è°ƒç”¨ <code>Bark</code> æ–¹æ³•ã€‚</p><h2 id=3-æˆå‘˜å‡½æ•°çš„å‚æ•°>3. æˆå‘˜å‡½æ•°çš„å‚æ•°</h2><p>åœ¨å®ç°ä¸­ï¼Œè°ƒç”¨æŸä¸ªç±»å‹çš„æˆå‘˜æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å…¶å®æ˜¯è¿™ä¸ªæ–¹æ³•çš„å®ç°å¯¹è±¡è‡ªèº«ï¼Œå³å¦‚æœæ˜¯ä¸€ä¸ªæŒ‡é’ˆçš„æ–¹æ³•ï¼Œå°±æ˜¯è¿™ä¸ªæŒ‡é’ˆçš„å€¼ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°±æ˜¯è¿™ä¸ªå¯¹è±¡çš„å€¼ã€‚</p><p>ä¸‹é¢ä½¿ç”¨ Go 1.8.3 å±•ç¤ºï¼Œå› ä¸ºå½“å‰æœ€æ–°çš„ Go ç¼–è¯‘å™¨åœ¨æ‰“å° stack trace çš„æ—¶å€™ä¸å†æ‰“å°å‡½æ•°çš„å‚æ•°ï¼ˆè¿™ä¸ªä¾‹å­ä¸­ï¼‰ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>R1</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>n</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>R1</span><span class=p>)</span> <span class=nf>f</span><span class=p>(</span><span class=nx>n</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nb>println</span><span class=p>(</span><span class=s>&#34;received&#34;</span><span class=p>,</span> <span class=nx>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nb>panic</span><span class=p>(</span><span class=s>&#34;just a panic&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>R1</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>	<span class=nx>a</span> <span class=o>:=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>	<span class=nb>println</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=p>.</span><span class=nf>f</span><span class=p>(</span><span class=nx>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><pre tabindex=0><code>0xc420039f70
received 1
panic: just a panic

goroutine 1 [running]:
main.(*R1).f(0xc420039f70, 0x1)
	/Users/bef0rewind/Projects/net example/src/main/receiver_type.go:9 +0xa3
main.main()
	/Users/bef0rewind/Projects/net example/src/main/receiver_type.go:16 +0x5a
</code></pre><p>Stack trace ä¸­å‡½æ•° <code>f</code> ç¬¬ä¸€ä¸ªå€¼æ˜¯æŒ‡é’ˆ <code>r</code> çš„å€¼ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>R1</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>n</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>	<span class=nx>m</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>R1</span><span class=p>)</span> <span class=nf>f</span><span class=p>(</span><span class=nx>n</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nb>println</span><span class=p>(</span><span class=s>&#34;received&#34;</span><span class=p>,</span> <span class=nx>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nb>panic</span><span class=p>(</span><span class=s>&#34;just a panic&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=nx>R1</span><span class=p>)</span> <span class=nf>g</span><span class=p>(</span><span class=nx>n</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nb>println</span><span class=p>(</span><span class=s>&#34;received&#34;</span><span class=p>,</span> <span class=nx>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nb>panic</span><span class=p>(</span><span class=s>&#34;just a panic&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span> <span class=o>:=</span> <span class=nx>R1</span><span class=p>{</span><span class=mi>7</span><span class=p>,</span> <span class=mi>9</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>a</span> <span class=o>:=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>	<span class=nb>println</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>(</span><span class=nx>r</span><span class=p>).</span><span class=nf>g</span><span class=p>(</span><span class=nx>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><pre tabindex=0><code>7
received 1
panic: just a panic

goroutine 1 [running]:
main.R1.g(0x7, 0x9, 0x1)
	/Users/bef0rewind/Projects/net example/src/receiver_type/main/args.go:15 +0xa3
main.main()
	/Users/bef0rewind/Projects/net example/src/receiver_type/main/args.go:22 +0x58
</code></pre><p>Stack trace ä¸­å‡½æ•° <code>g</code> ç¬¬ä¸€ä¸ªå€¼æ˜¯ <code>r</code> çš„å€¼ <code>7</code> å’Œ <code>9</code>ã€‚</p><p>ä»è¿™ä¸ªå®ç°æ–¹å¼ä¸­æˆ‘ä»¬å¯ä»¥æ¨æ–­ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>Go è¯­è¨€é‡‡ç”¨å‚æ•°ä¼ å€¼çš„æ–¹å¼è¿›è¡Œå‡½æ•°è°ƒç”¨ï¼Œå› æ­¤å¦‚æœå¯¹è±¡å¾ˆå¤§ï¼Œä½¿ç”¨çš„å¯¹è±¡æœ¬èº«è°ƒç”¨å‡½æ•°ä¼šå¸¦æ¥å¤§é‡çš„å¤åˆ¶</li><li>ä¸å¯èƒ½åœ¨å‡½æ•°è°ƒç”¨ä¸­æ”¹å˜å‡½æ•°å¤–çš„è°ƒç”¨è€…ï¼Œå› ä¸ºä¼ åˆ°å‡½æ•°å†…éƒ¨çš„åªæ˜¯è°ƒç”¨è€…çš„å‰¯æœ¬</li></ul><h2 id=4-ä½¿ç”¨æ¥å£è°ƒç”¨å‡½æ•°>4. ä½¿ç”¨æ¥å£è°ƒç”¨å‡½æ•°</h2><p>åŸºäºè¿™æ ·çš„æˆå‘˜å‡½æ•°å®ç°æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å¦å¤–ä¸€ç§è°ƒç”¨æ–¹å¼ï¼šä½¿ç”¨æ¥å£ç±»å‹è°ƒç”¨ä¸€ä¸ªå‡½æ•°ã€‚
è¿™é‡Œä¸æ˜¯å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆç‰¹å®šçš„æ¥å£ç„¶åå»è°ƒç”¨å‡½æ•°ï¼Œè€Œæ˜¯ä½¿ç”¨æ¥å£ç±»å‹æœ¬èº«å»è¿›è¡Œå‡½æ•°è°ƒç”¨ã€‚
è¿™ç§æ–¹å¼åœ¨ Go 1.9 ä¸­å¼€å§‹æ”¯æŒï¼Œåœ¨ Go 1.10 å¼€å§‹å†™å…¥ Go çš„ specsã€‚è¿™ä¸ªä¾‹å­ä½¿ç”¨çš„æ˜¯ Go master åˆ†æ”¯çš„ç‰ˆæœ¬ï¼Œå¯èƒ½æ˜¯ Go 1.11ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>M</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=o>*</span><span class=nx>M</span><span class=p>)</span> <span class=nf>f</span><span class=p>(</span><span class=nx>n</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nb>println</span><span class=p>(</span><span class=s>&#34;I;m M, with&#34;</span><span class=p>,</span> <span class=nx>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>IM</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>f</span><span class=p>(</span><span class=nx>n</span> <span class=kt>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>m</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>M</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>	<span class=nx>IM</span><span class=p>.</span><span class=nf>f</span><span class=p>(</span><span class=nx>m</span><span class=p>,</span> <span class=mi>7</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><pre tabindex=0><code>I;m M, with 7
</code></pre><p>æ­¤å¤–è¿˜èƒ½ä½¿ç”¨åŒ¿åæ¥å£ç±»å‹å»è°ƒç”¨å‡½æ•°ï¼Œä¾‹å¦‚ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>M</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=o>*</span><span class=nx>M</span><span class=p>)</span> <span class=nf>f</span><span class=p>(</span><span class=nx>n</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nb>println</span><span class=p>(</span><span class=s>&#34;I;m M, with&#34;</span><span class=p>,</span> <span class=nx>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>m</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>M</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>	<span class=kd>interface</span><span class=p>{</span><span class=nf>f</span><span class=p>(</span><span class=nx>n</span> <span class=kt>int</span><span class=p>)}.</span><span class=nf>f</span><span class=p>(</span><span class=nx>m</span><span class=p>,</span> <span class=mi>7</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿è¡Œç»“æœä¸ä¸Šé¢çš„ä¸€æ®µé‡‡ç”¨ <code>IM</code> æ¥å£å®šä¹‰çš„ä¾‹å­æ˜¯ä¸€æ ·çš„ã€‚</p><h2 id=5-æ³¨å…¥ä¾èµ–>5. æ³¨å…¥ä¾èµ–</h2><p>æœ‰æ—¶å€™ä¸€ä¸ªå¯¹è±¡åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå®ƒçš„ä¸€äº›æˆå‘˜æ–¹æ³•çš„è¡Œä¸ºå¯èƒ½è¿˜æ²¡æœ‰ç¡®å®šï¼Œéœ€è¦ä¾èµ–å¤–ç•Œæ³¨å…¥ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥åœ¨å¯¹è±¡ç±»å‹å®šä¹‰ä¸­å†…åµŒä¸€ä¸ªæ¥å£ï¼Œç„¶ååœ¨åæœŸä¼ å…¥ä¸€ä¸ªæ¥å£çš„å®ä¾‹æ¥ç¡®å®šå…¶è¡Œä¸ºã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>BinaryOp</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>Compute</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>ComputeNode</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>x</span><span class=p>,</span> <span class=nx>y</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>	<span class=nx>BinaryOp</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>node</span> <span class=o>*</span><span class=nx>ComputeNode</span><span class=p>)</span> <span class=nf>Result</span><span class=p>()</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>node</span><span class=p>.</span><span class=nx>BinaryOp</span><span class=p>.</span><span class=nf>Compute</span><span class=p>(</span><span class=nx>node</span><span class=p>.</span><span class=nx>x</span><span class=p>,</span> <span class=nx>node</span><span class=p>.</span><span class=nx>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Add</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=o>*</span><span class=nx>Add</span><span class=p>)</span> <span class=nf>Compute</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>a</span> <span class=o>+</span> <span class=nx>b</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Multi</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=o>*</span><span class=nx>Multi</span><span class=p>)</span> <span class=nf>Compute</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>a</span> <span class=o>*</span> <span class=nx>b</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>node</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>ComputeNode</span><span class=p>{</span><span class=nx>x</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span> <span class=nx>y</span><span class=p>:</span><span class=mi>3</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>node</span><span class=p>.</span><span class=nx>BinaryOp</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>Add</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>	<span class=nb>println</span><span class=p>(</span><span class=nx>node</span><span class=p>.</span><span class=nf>Result</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>node</span><span class=p>.</span><span class=nx>BinaryOp</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>Multi</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>	<span class=nb>println</span><span class=p>(</span><span class=nx>node</span><span class=p>.</span><span class=nf>Result</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><pre tabindex=0><code>5
6
</code></pre><p>æ³¨æ„ä¸€å®šè¦è®°å¾—ä¼ å…¥æ¥å£çš„å®ä¾‹ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­å¦‚æœä¸ç»™ <code>node</code> ä¼ å…¥ä¸€ä¸ª <code>BinaryOp</code> æ¥å£å®ä¾‹ï¼Œé‚£ <code>node.BinaryOp</code> æ˜¯ <code>nil</code>ï¼Œåœ¨è°ƒç”¨ <code>Compute</code> æ–¹æ³•çš„æ—¶å€™å°±ä¼šå‘ç”Ÿå¼‚å¸¸ã€‚ä¾‹å¦‚å°†ä¸Šé¢çš„ <code>main</code> å‡½æ•°ç¨ä½œä¿®æ”¹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>node</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>ComputeNode</span><span class=p>{</span><span class=nx>x</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span> <span class=nx>y</span><span class=p>:</span><span class=mi>3</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>//node.BinaryOp = &amp;Add{}
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nb>println</span><span class=p>(</span><span class=nx>node</span><span class=p>.</span><span class=nf>Result</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><pre tabindex=0><code>panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x104d8d7]

goroutine 1 [running]:
main.(*ComputeNode).Result(...)
	/Users/bef0rewind/Projects/net example/src/receiver_type/main/injection.go:13
main.main()
	/Users/bef0rewind/Projects/net example/src/receiver_type/main/injection.go:32 +0x47
</code></pre><h2 id=6-å†…éƒ¨æœºåˆ¶>6. å†…éƒ¨æœºåˆ¶</h2><p>å†…éƒ¨æœºåˆ¶æœ‰ä¸€äº›ç»†èŠ‚ã€‚å¤§ä½“å°±æ˜¯ä¸€ä¸ªæ¥å£ <code>i</code> åŒ…å«ä¸¤éƒ¨åˆ†å†…å®¹ï¼ˆæŒ‡é’ˆï¼‰ï¼Œä¸€ä¸ªæ˜¯æ¥å£ä»£è¡¨çš„æ–¹æ³•çš„é›†åˆï¼Œä¸€ä¸ªå®ç°è¿™ä¸ªæ¥å£çš„å…·ä½“å¯¹è±¡ï¼›è€Œä¸€ä¸ªå¯¹è±¡ <code>obj</code>ï¼Œå®ƒåŒ…å«äº†è‡ªå·±çš„å†…å­˜ä¸­çš„å€¼ï¼Œä¹Ÿèƒ½é€šè¿‡å…¶ç±»å‹è·å–åˆ° <code>obj</code> å®ç°çš„æ–¹æ³•é›†åˆã€‚</p><p>å°†è¿™ä¸¤ä¸ªæ¦‚å¿µè®°ä½ï¼Œåœ¨å®ç°ä¸€äº›æ¨¡å¼çš„æ—¶å€™å°±ä¼šå°‘å¾ˆå¤šå¿ƒæ™ºè´Ÿæ‹…ã€‚</p><h2 id=7-æ€»ç»“>7. æ€»ç»“</h2><p>Go è¯­è¨€çš„è¿™å¥—åŸºäº â€œduck typingâ€ çš„æœºåˆ¶å¥½ä¸å¥½ï¼Œäº‰è®ºæœ‰å¾ˆå¤šã€‚ä¸è¿‡æˆ‘ä¸€å‘å¯¹è¿™äº›äº‰è®ºæ²¡æœ‰ç‰¹åˆ«çš„å€¾å‘ï¼Œè‡³å°‘ç†è§£å…¶æœºåˆ¶ä¹‹åæŒ‰ç…§å…¶è®¾è®¡æ€è·¯æ¥ç”¨è¿˜å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œè€Œä¸”é‡Œé¢æ²¡æœ‰å¤æ‚çš„æ¦‚å¿µå’Œä¾‹å¤–æƒ…å½¢ã€‚</p><p>ä¹Ÿè®¸æˆ‘çš„ç†è§£æœ‰åå·®ï¼Œä½†ç°åœ¨è¿˜æ²¡æœ‰å‘ç°ä»€ä¹ˆçŸ›ç›¾çš„åœ°æ–¹ã€‚</p></div></article></main></body></html>