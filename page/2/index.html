<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>不是追风少年</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="我在生活中汲取力量">
<meta property="og:type" content="website">
<meta property="og:title" content="不是追风少年">
<meta property="og:url" content="http://blog.formalscience.com/page/2/index.html">
<meta property="og:site_name" content="不是追风少年">
<meta property="og:description" content="我在生活中汲取力量">
<meta property="article:author" content="Bef0rewind">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="不是追风少年" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon-animate.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">不是追风少年</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.formalscience.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-2018-07-06-Battery-Life" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/06/2018-07-06-Battery-Life/" class="article-date">
  <time datetime="2018-07-06T00:00:00.000Z" itemprop="datePublished">2018-07-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%9B%9E%E5%BF%86%E4%B8%AD%E8%80%81%E5%8E%BB/">回忆中老去</a>►<a class="article-category-link" href="/categories/%E5%9B%9E%E5%BF%86%E4%B8%AD%E8%80%81%E5%8E%BB/%E6%84%9F%E6%82%9F/">感悟</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/06/2018-07-06-Battery-Life/">电池人生</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>电池，一般狭义上的定义是将本身储存的化学能转成电能的装置，广义的定义为将预先储存起的能量转化为可供外用电能的装置。因此，像太阳能电池只有转化而无储存功能的装置不算是电池。其他名称有电瓶、电芯，而中文池及瓶也有储存作用之意。</p>
</blockquote>
<blockquote>
<p>《维基百科》</p>
</blockquote>
<p>5 月份上海校友会来杭州参观，我带队去云栖景区玩，后来大家一起去了阿里西溪园区。园区很漂亮，中间有一块地被高墙围起，据说马云在那里开董事会。后面有个讨论环节，那时我已经昏昏欲睡了，只记得那个阿里 P11 说今后公司要拓展的方向是娱乐和健康。</p>
<p>娱乐和健康都是人生活的必需品。</p>
<p>最近认识一些朋友去今日头条工作了。这个公司的应用通过算法构建消息流推送到人们的移动终端。在信息泛滥的今天，可以永远向下滑动手指，看到无尽的“新”闻。可算法知道，这些新闻的类型是你喜欢的，同样的主题是你的老朋友了。</p>
<p>当然这样的应用通常不需要你付费，因为你就是它们的商品。一次次的滑动中除了那些通过视网膜输入的新闻还有各式各样的广告，都是基于你的“兴趣”进行筛选后的结果。它们攫取你的时间卖给了肯花钱展示商品的人，赚到了差价。</p>
<p>以前看黑客帝国的时候，总是不明白 Matrix 那么发达，却还是需要将人关在营养仓里当做电池使用。人是消耗能量的啊！最近才逐渐有所领悟，人体不一定可以拿来产生能量。人作为进化的产物，智能依赖生物结构，Matrix 可以将一个个的人作为基础的计算组件，用来支撑虚拟世界中的各种计算。现在我们使用人工智能也是如此，用来识别人脸、用来预测天气 ……</p>
<p>《海伯利安》中有一个设定，机器智能帮助人类构建了可以在宇宙各处穿梭的跃迁节点，而这种技术远远超出了人类的理解范围。人们以为这是机器智能回馈给它们的“造物主”的礼物，但实际上这是一个陷阱。人穿梭过跃迁节点从另一侧出来并不是瞬间完成的。在节点中度过的无法感知到的时间中，人的大脑的计算能力被机器智能利用，完成了自身的不断进化，来追求它们的终极目标。</p>
<p>在阿西莫夫的经典作品《我，机器人》改编的电影中，威尔•史密斯扮演的黑人警探戴尔•斯普纳不相信人类能和机器人和平共处，故事的各种冲突也从此展开。这部作品的底线是机器人还遵守“机器人三定律”，虽然是被以某种人类意想不到的方式施行的。现实中，我们能对机器人有所期待吗？我们能对创造机器人的人有所期待吗？</p>
<p>总是有人对新的技术保持怀疑 —— 有些人因为未知而恐惧，有些人因为远见而忧虑，只有中间的人享受着生活。</p>
<p>有时候想人的一生好短暂，也就一百年。昨天看到淡豹的一篇文章《近日新闻有感》，中间有一大段对日常种种琐事的描述，读的过程中仿佛头被浸在水中。究竟是什么（强大的）力量在驱使我们生活？</p>
<p>在我看来这种力量里又加入了一方势力，有些人在尽最大努力使用着智能算法来侵占人的生命。以前他们也这样做，通过编辑人们喜欢的花边新闻和轶事来吸引人们注意，不过那种方式毕竟低效。现在算法可以让人们通过滑动手指，自己戴上镣铐，出卖生命。</p>
<p>小的时候，有段时间我很喜欢四驱车，当然是在看了《四驱小子》之后。终于有了一辆（无影剑）后，我发现了一个现实的问题：这车跑起来很费电池，于是又攒钱买充电电池。最终电池的能量变成了车在赛道上前进的动力以及我的回忆。</p>
<p>我对四驱车的欲望肯定是来自动画片，后来我弟弟那时候买的就是悠悠球了。人的大脑是可以被外界信息影响的，现代科技也会以某种方式对人的大脑进行编程。现在人脑运行的机制还不清楚，如果可行的话，那些广告商肯定想通过某种方式对你的大脑进行编程，让你看一遍广告就下单购物。</p>
<p>我前段时间在想：如果总是接受这样被算法（你的手指）选择过的信息，会变傻吗？至少我体会过那种无效信息过载的时刻，就是大脑没什么感觉了。</p>
<p>在这个过程中我们到底付出了什么呢？我们的时间，我们的未来。</p>
<p>随着时间的推移，人的未来就逐渐坍缩，直到生命终点，也就没有未来了。每一秒过去，我们的未来就少了几分可能性。</p>
<p>如果明天不值得期待，就继续燃烧自己吧。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.formalscience.com/2018/07/06/2018-07-06-Battery-Life/" data-id="ckpoawmgs001fitp93p2t3hdy" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2018-06-23_update_VPS_Ubuntu_version" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/23/2018-06-23_update_VPS_Ubuntu_version/" class="article-date">
  <time datetime="2018-06-23T00:00:00.000Z" itemprop="datePublished">2018-06-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF%E8%AE%B0%E5%BD%95/">技术记录</a>►<a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF%E8%AE%B0%E5%BD%95/tech-notes/">tech-notes</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/23/2018-06-23_update_VPS_Ubuntu_version/">Upgrade DigitalOcean&#39;s Ubuntu 17.04 to LTS version in 2018-06</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="What-happened"><a href="#What-happened" class="headerlink" title="What happened?"></a>What happened?</h2><p>I found my proxy for accessing some websites stopped working today, so I had to change my VPS’s IP address.<br>After some trials, everything seemed OK and I started watching a skiing video made by NorthFace on Youtube.</p>
<p>Emmmm, I noticed 12 packages needed to be updated.<br>Well, I typed <code>sudo apt-get update</code> and got messages like this (I didn’t save the error messages then):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">  404  Not Found [IP: 91.189.91.23 80]</span><br><span class="line">Ign:10 http:&#x2F;&#x2F;us.archive.ubuntu.com&#x2F;ubuntu zesty-backports InRelease</span><br><span class="line">Err:11 http:&#x2F;&#x2F;us.archive.ubuntu.com&#x2F;ubuntu zesty Release</span><br><span class="line">  404  Not Found [IP: 91.189.91.26 80]</span><br><span class="line">Err:12 http:&#x2F;&#x2F;us.archive.ubuntu.com&#x2F;ubuntu zesty-updates Release</span><br><span class="line">  404  Not Found [IP: 91.189.91.26 80]</span><br><span class="line">Err:13 http:&#x2F;&#x2F;us.archive.ubuntu.com&#x2F;ubuntu zesty-backports Release</span><br><span class="line">  404  Not Found [IP: 91.189.91.26 80]</span><br><span class="line">Reading package lists... Done</span><br><span class="line">E: The repository &#39;http:&#x2F;&#x2F;security.ubuntu.com&#x2F;ubuntu zesty-security Release&#39; does no longer have a Release file.</span><br><span class="line">N: Updating from such a repository can&#39;t be done securely, and is therefore disabled by default.</span><br><span class="line">N: See apt-secure(8) manpage for repository creation and user configuration details.</span><br><span class="line">E: The repository &#39;http:&#x2F;&#x2F;us.archive.ubuntu.com&#x2F;ubuntu zesty Release&#39; does no longer have a Release file.</span><br><span class="line">N: Updating from such a repository can&#39;t be done securely, and is therefore disabled by default.</span><br><span class="line">N: See apt-secure(8) manpage for repository creation and user configuration details.</span><br><span class="line">E: The repository &#39;http:&#x2F;&#x2F;us.archive.ubuntu.com&#x2F;ubuntu zesty-updates Release&#39; does no longer have a Release file.</span><br><span class="line">N: Updating from such a repository can&#39;t be done securely, and is therefore disabled by default.</span><br><span class="line">N: See apt-secure(8) manpage for repository creation and user configuration details.</span><br><span class="line">E: The repository &#39;http:&#x2F;&#x2F;us.archive.ubuntu.com&#x2F;ubuntu zesty-backports Release&#39; does no longer have a Release file.</span><br><span class="line">N: Updating from such a repository can&#39;t be done securely, and is therefore disabled by default.</span><br><span class="line">N: See apt-secure(8) manpage for repository creation and user configuration details.</span><br></pre></td></tr></table></figure>

<p>Wow, It was the first time I encountered such things.<br>After some digging, I realized it was because Ubuntu 17.04 (zesty) was not supported any longer.</p>
<p>According to <a href="https://wiki.ubuntu.com/ZestyZapus/ReleaseNotes" target="_blank" rel="noopener">https://wiki.ubuntu.com/ZestyZapus/ReleaseNotes</a></p>
<blockquote>
<p>Ubuntu 17.04 will be supported for 9 months until January 2018. If you need Long Term Support, it is recommended you use Ubuntu 16.04 LTS instead.</p>
</blockquote>
<p>It means my current release version (Ubuntu 17.04) won’t receive any updates in the future. </p>
<p><img src="https://assets.ubuntu.com/v1/f02f0a4b-r-eol-ubuntu-full-2018-02-28.png" alt="release-end-of-life-date"></p>
<h2 id="How-to-upgrade"><a href="#How-to-upgrade" class="headerlink" title="How to upgrade"></a>How to upgrade</h2><p>I was struggled to reveal some steps to upgrade my Ubuntu 17.04 (End-of-Life) to 18.04 (LTS version).</p>
<p>The official guide to upgrade from an Ubuntu release which reaches its “end of life” is: <a href="https://help.ubuntu.com/community/EOLUpgrades" target="_blank" rel="noopener">https://help.ubuntu.com/community/EOLUpgrades</a></p>
<h3 id="1-Update-sources-list"><a href="#1-Update-sources-list" class="headerlink" title="1. Update sources.list"></a>1. Update sources.list</h3><p>The path of <em>sources.list</em> is <em>/etc/apt/sources.list</em>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">## EOL upgrade sources.list</span><br><span class="line"># Required</span><br><span class="line">deb http:&#x2F;&#x2F;old-releases.ubuntu.com&#x2F;ubuntu&#x2F; CODENAME main restricted universe multiverse</span><br><span class="line">deb http:&#x2F;&#x2F;old-releases.ubuntu.com&#x2F;ubuntu&#x2F; CODENAME-updates main restricted universe multiverse</span><br><span class="line">deb http:&#x2F;&#x2F;old-releases.ubuntu.com&#x2F;ubuntu&#x2F; CODENAME-security main restricted universe multiverse</span><br><span class="line"></span><br><span class="line"># Optional</span><br><span class="line">#deb http:&#x2F;&#x2F;old-releases.ubuntu.com&#x2F;ubuntu&#x2F; CODENAME-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure>

<p>In my case, <code>CODENAME</code> should be replaced by <code>zesty</code>.</p>
<h3 id="2-Upgrade"><a href="#2-Upgrade" class="headerlink" title="2. Upgrade"></a>2. Upgrade</h3><p>Try <code>apt-get upgrade</code>, and I got:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dpkg: dependency problems prevent configuration of ubuntu-standard:</span><br><span class="line"> ubuntu-standard depends on libpam-systemd; however:</span><br><span class="line">  Package libpam-systemd:amd64 is not configured yet.</span><br></pre></td></tr></table></figure>

<p>By some method suggested by stackoverflowers, I finally got over it by these commands:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg --force-all -P libpam-systemd</span><br><span class="line">sudo apt-get -f install libpam-systemd</span><br></pre></td></tr></table></figure>

<h3 id="3-Dist-Upgrade"><a href="#3-Dist-Upgrade" class="headerlink" title="3. Dist Upgrade"></a>3. Dist Upgrade</h3><p>These are some normal steps for an upgrade.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get dist-upgrade</span><br><span class="line">sudo do-release-upgrade</span><br></pre></td></tr></table></figure>

<p>If you’re unlucky like me, you will not upgrade to a newer release completely.<br>You may see:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Package grub-efi-amd64 is not configured yet.</span><br></pre></td></tr></table></figure>

<p>According to <a href="https://askubuntu.com/questions/330531/unable-to-fix-broken-package-system" target="_blank" rel="noopener">a question</a> asked by someone, you can try this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg --force-all -P grub-efi-amd64</span><br><span class="line">sudo dpkg --force-all -P grub-efi-amd64-signed</span><br></pre></td></tr></table></figure>

<p>Execute <code>sudo apt-get update</code> and <code>sudo apt-get upgrade</code>.</p>
<h3 id="4-Thoughts"><a href="#4-Thoughts" class="headerlink" title="4. Thoughts"></a>4. Thoughts</h3><p>I first upgraded to Ubuntu 17.10 then Ubuntu 18.04.</p>
<p>To see if I have done the right things, I check the release version by <code>sudo lsb_release -a</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Distributor ID:    Ubuntu</span><br><span class="line">Description:       Ubuntu 18.04 LTS</span><br><span class="line">Release:           18.04</span><br><span class="line">Codename:          bionic</span><br></pre></td></tr></table></figure>

<p>Is it the DigitalOcean’s customized release makes the upgrade so complex for a non-expert programmer or the Ubuntu release itself?</p>
<p>But apparently, I’m not the only one who is confused by the error messages and asks questions on the web. Luckily I’ve found helping answers I need. </p>
<p>The commands with words like <code>force</code> or <code>-f</code> make me feel anxious.</p>
<blockquote>
<p>These violent delights have violent ends.<br>— by Shakespeare</p>
</blockquote>
<p><img src="https://cdn.vox-cdn.com/thumbor/NxFcQHzIb1eqgk5EXafSzFwy2UU=/0x0:5100x3400/920x613/filters:focal(1816x555:2632x1371):format(webp)/cdn.vox-cdn.com/uploads/chorus_image/image/52220535/westworld_dolores.0.jpeg" alt="Dolores"></p>
<p>Anyway, it works.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.formalscience.com/2018/06/23/2018-06-23_update_VPS_Ubuntu_version/" data-id="ckpoawmgr001eitp9ajdid6uj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2018-05-12_理解_C++_Traits" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/02/2018-05-12_%E7%90%86%E8%A7%A3_C++_Traits/" class="article-date">
  <time datetime="2018-05-02T19:43:00.000Z" itemprop="datePublished">2018-05-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF%E8%AE%B0%E5%BD%95/">技术记录</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/02/2018-05-12_%E7%90%86%E8%A7%A3_C++_Traits/">理解 C++ Traits</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>C++ 是我学习的第一种编程语言，当时是 2007 年。现在 C++ 标准委员会已经在讨论 2020 年要发布的特性了，我连 2011 年发布的 Traits 都还不知道是啥。今天下定决心了解总结一下。</p>
<p>C++ 之父 Bjarne Stroustrup 说：</p>
<blockquote>
<p>Think of a trait as a small object whose main purpose is to carry information used by another object or algorithm to determine “policy” or “implementation details”.</p>
</blockquote>
<p>嗯，这段描述也比较抽象。我的理解是，trait 把不同类型的特定信息进行打包，用在算法或者其他对象中。这样算法或者其他对象的设计可以做到更加通用，通过 trait 打包的信息进行策略选择或者实现细节。</p>
<p><img src="/uploads/trait1.png" alt="trait1"></p>
<p>这段代码判断两个类型的关系。第 4 行的模板以两个类型作为参数，通过结构体 <code>type_relation</code> 的成员 <code>relation</code> 获取比较结果。当前代码输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type_relation&lt;bool, int&gt;: different</span><br><span class="line">type_relation&lt;int, int&gt;: different</span><br></pre></td></tr></table></figure>

<p>这段代码并未实现预期功能，因为比较 <code>bool</code> 和 <code>int</code>，以及 <code>int</code> 和 <code>int</code> 时，都输出 <code>&quot;different&quot;</code> 。下面继续完善这个 trait 实现。</p>
<p><img src="/uploads/trait2.png" alt="trait2"></p>
<p>第 11 行的类型参数种使用 <code>&lt;T, T&gt;</code> （即两个相同的类型）进行模式匹配。这段代码输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type_relation&lt;bool, int&gt;: different</span><br><span class="line">type_relation&lt;int, int&gt;: equal</span><br></pre></td></tr></table></figure>

<p>输出结果正确完成了类型比较的功能。</p>
<hr>
<p><strong>实现</strong></p>
<p>trait 的实现基于 C++ 的模板引擎（template engine），能够在<strong>编译时期（compile time）</strong>将模板（基于最匹配的模式）展开。如果要在 Golang 或者 Java 种实现类似功能，可以使用反射或者 interface 之类的方法，而这些方法都是在运行时（runtime）进行判定，不可避免带来性能开销。</p>
<hr>
<p><strong>进阶</strong></p>
<p>除了可以比较两个类型是否相等，还可以在类型参数上添加其他约束，例如：<code>*</code>、<code>[]</code> 等。下面是一个稍微复杂一些的版本：</p>
<p><img src="/uploads/trait3.png" alt="trait3"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">type_relation&lt;bool, int&gt;: different</span><br><span class="line">type_relation&lt;int, int&gt;: equal</span><br><span class="line">type_relation&lt;int*, int&gt;: is pointer of</span><br><span class="line">type_relation&lt;int[], int&gt;: is array of</span><br><span class="line">type_relation&lt;int[4], int&gt;: is array (length 4) of</span><br></pre></td></tr></table></figure>

<p>当然这个“进阶”仅仅是比上面的例子复杂了一些，trait 还有更多能力。<br>C++ 的模板引擎为 C++ 提供了强大的元编程（meta programming）能力，也使得现代的 C++ 代码看上去比较奇怪。<br>事实上模板引擎是图灵完备的，如果使用好的话，能够将 C++ 的易用性和优雅性提升到一个高度（从那些看不到模板实现细节的用户的视角）。</p>
<hr>
<p><strong>感想</strong></p>
<p>每次 C++ 标准更新的新闻我都看到了，从 C++0X、C++11、C++14 到 C++17，新出的特性一直在关注，可却从来没有真正编写一段程序去试试这些特性。这让我很伤感。</p>
<p>看到新的语言就想去尝试，OCaml、Clojure、Haskell …… 这些语言都很有特色，OCaml 让我体会到模式匹配的爽快，Clojure 让我体会到 S-表达式的自由和 Lisp 宏的强大，Haskell 让我体会到抽象的威力以及自己脑容量的有限。可是工作中用的最多的还是 Python、Java 和 C，当然还有 PHP （这个不能忘）。</p>
<p>想我和 C++ 的关系，最初的时候还是看的 Bjarne Stroustrup 的《The C++ Programming Language》。后来怎么就越走越远了呢？虽然现在工作中暂时依旧用不到，还是希望以此为契机，了解更多模板引擎可以做的事情。</p>
<p>追逐过的其他语言，各有各的契机，或许是缘分，或许是喜欢，或许是虚荣。现在都不敢说自己会 C++ 了。<br>如果当时能够更专注一些，自己目前的职业轨迹会不会有所区别？</p>
<p>想起最初自己理解 Haskell 里 <code>Monad</code> 概念的时候，一头雾水。后来懂了，就是懂了。为什么偏爱某一种语言呢？我也搞不清楚自己。</p>
<p>也许爱情也是如此，回忆当初做的不同结果是否能够更好？也许。记住过往，抗拒住回忆的诱惑，很难，但不得不做。喜欢的，就喜欢着吧。有些事情就是不行，正如有些事情莫名其妙地发生。</p>
<p>Just live with it.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.formalscience.com/2018/05/02/2018-05-12_%E7%90%86%E8%A7%A3_C++_Traits/" data-id="ckpoawmgm0019itp96xoy9a4j" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2018-05-27_2016_十一塞罕坝行动" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/02/2018-05-27_2016_%E5%8D%81%E4%B8%80%E5%A1%9E%E7%BD%95%E5%9D%9D%E8%A1%8C%E5%8A%A8/" class="article-date">
  <time datetime="2018-05-02T19:43:00.000Z" itemprop="datePublished">2018-05-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B1%B1%E9%87%8E/">山野</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/02/2018-05-27_2016_%E5%8D%81%E4%B8%80%E5%A1%9E%E7%BD%95%E5%9D%9D%E8%A1%8C%E5%8A%A8/">2016 十一塞罕坝行动</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这是很久之前应该出现的一篇日志，当时忙于处理照片、毕业论文之类的事情，加上强烈的懈怠情绪，一直没写。</p>
<hr>
<p>2016 年暑假过后开学不久，政委喊大家出去骑车，这注定会很有趣。目的地是承德的塞罕坝，不是张家口的坝上草原。<br>主题是骑行、赏秋景。大家确认好时间后，大家定了火车票，提前去西直门北京北站托运了自行车。剩下的就是等待出行了。</p>
<p>塞罕坝国家森林公园位于承德北部，毗邻内蒙古（上面），是清代皇家猎苑一部分，集满蒙汉三民族文化。<br>景区内有七星湖、太阳湖、泰丰湖、白桦林、月亮湖等较大的景点和多个小景点，自然风光和人文遗迹于一体。<br>（注：这些湖我们一个也没去，人文遗迹也没看到）<br>另外，还珠格格就是在这个地方被他皇阿玛一箭射中的。</p>
<p>整体路线规划为：</p>
<ul>
<li>北京北 - 四合永镇 （火车）</li>
<li>四合永镇 - 围场县 （骑车、住宿）</li>
<li>围场县 - 机械林场 （骑车、住宿）</li>
<li>机械林场 - 半截塔镇 （骑车、住宿）</li>
<li>半截塔镇 - 隆化县 （骑车）</li>
<li>隆化县 - 北京北 （火车）</li>
</ul>
<h2 id="Day-0"><a href="#Day-0" class="headerlink" title="Day 0"></a>Day 0</h2><p>火车上的旅行总是欢快的，小帅哥 YL 拿了很多桌游，大家玩啊玩。<br>在玩阿瓦隆的时候，某个女博士一脸愁容，明显就是脑细胞不够用的表现。<br>路上路过了很多听过但是没去过的地方，比如古北口。</p>
<p>到了四合永镇，取车合影。</p>
<p><img src="/uploads/2016-together1.jpg" alt="Gubeikou"></p>
<p>到围场县很近，我们很快就骑到了，安顿好了住宿。肚子饿的呱呱叫，出去觅食，集体决定吃火锅（作为吃饭不挑剔的我当然也给不出什么建设性意见）。<br>一行人吃得热火朝天，风生水起，生龙活虎。最后算账，人均三十。</p>
<p><img src="/uploads/2016-together2.jpg" alt="Hot Pot"></p>
<p>然后去附近的超市准备接下来几天的食粮。水果、面包、零食、饮料，各种东西都来点。<br>逛超市比较有意思的是看到各种东西分门别类堆在一起，那么多，又都很光鲜。虽然不能都买了，但总有种莫名的愉悦感。</p>
<p><img src="/uploads/2016-things1.jpg" alt="Supermarket"></p>
<p>晚上还是玩玩玩，时刻压制住情绪，以免吵到其他人。</p>
<h2 id="Day-1"><a href="#Day-1" class="headerlink" title="Day 1"></a>Day 1</h2><p>第二天按时起床，旁边小店吃了早饭，准备出发。<br>说到这个出发，还是有些字面意义上的周折。小城在修路，大家凭着感觉和导航终于骑了出去。</p>
<p>骑车嘛，还是为了拍照。一路上大家各种互拍、自拍，对着天空、河流、群山拍。</p>
<p>骑车嘛，总会爆胎，尤其是漂亮的那种车，比如鲜红的挑战者 300。一路上补过胎的，没经验的，也基本都学会了。</p>
<p><img src="/uploads/2016-scene1.jpg" alt="scene1"></p>
<p><img src="/uploads/2016-scene2.jpg" alt="scene2"></p>
<p><img src="/uploads/2016-scene4.jpg" alt="scene4"></p>
<p>这样的景色大家拍来拍去，怎么也拍不厌。骑在这样的路上，也感觉不累（假的，毕竟在爬大坡）。</p>
<p>接近傍晚，天空的颜色变得多彩，而眼前原野的景色淡下去了。</p>
<p><img src="/uploads/2016-scene5.jpg" alt="scene5"></p>
<p><img src="/uploads/2016-scene3.jpg" alt="scene3"></p>
<p>剩下的就是赶路了，还要走一段公路到机械林场。虽然路上的景色也很美，但是看不到，只能通过黑黢黢的树影摇曳想象了。路上发生了一起意外，美女 GY 摔车了。<br>简单处理了一下，也只能继续骑车。到了机械林场后买了创可贴和碘酒暂时顶一下。</p>
<p><img src="/uploads/2016-together4.jpg" alt="together4"></p>
<p>晚上十点多大家吃了羊腿饭，景区物价高，不过仍不及五道口。住宿的话，还停暖和的，三个大男生挤一挤了，另外的妹子们怎么睡都随意了，虽然大家都是在一间屋子里吧。</p>
<h2 id="Day-2"><a href="#Day-2" class="headerlink" title="Day 2"></a>Day 2</h2><p><img src="/uploads/2016-together5.jpg" alt="together5"></p>
<p>第二天早上在店家吃了早餐，馒头、稀饭、饼、鸡蛋、炒小菜，典型的住店组合套餐（甚至在西藏也是这种组合……）。<br>出去后，开始下小雪，然后是小雨。大家都披上了雨衣。不过这注定是狼狈的、凄惨的、励志的一天 ……<br>我不说别人了，就说我自己吧。首先我的鞋子是登山鞋，防水的那种，可以避免水从外面进来，也可以防止水从里面出去。于是我就相当于穿着一个便携泡脚盆在骑车。<br>总之就是一种说不清道不明的酸楚与傻乐呵在心中交织。</p>
<p>最大的收获是，雨中的山林颜色更加润了。眼前的雨虽然冷，但是远处的雾气很没啊，我们是不畏风雨的骑车人。</p>
<p><img src="/uploads/2016-scene6.jpg" alt="scene6"></p>
<p><img src="/uploads/2016-scene7.jpg" alt="scene7"></p>
<p><img src="/uploads/2016-scene8.jpg" alt="scene8"></p>
<p>遇到一个便利店，大家进去买了各种包裹隔离物品（塑料袋），试图把自己的脚和腿保护起来。<br>中午在一个小饭馆吃了面，面对有点凶狠的狗去上了厕所。<br>吃完饭接着骑车，然后大家的车纷纷爆了胎，前面爆完后面爆胎。<br>忘记提的一点是，我带的补胎片失效了。<br>而备胎也用光了，于是各种打气筒接力打气艰难前行。<br>直到政委看到了一个给汽车补胎的地方，我们借用先进装备磨胎，强力胶水补胎，颇有种鸟枪换炮的感觉。</p>
<p>我最为先锋官，到了半截塔镇，发现了一个问题：有人办婚礼，没旅馆可以住了。<br>大家到了后，决定一拨人先买点东西吃饭，政委向来时方向去找住的地方，我向前面骑，去看看镇子里有没有住的地方。<br>我本来看到一家说可以的，但是后来店主说很抱歉，他现在在外地，只有自己孩子在家不放心。<br>幸好政委找到了一家汽车旅馆，住的地方有着落了，安心吃饭喽。</p>
<p>这天路上还遇到了交通事故，别人的。车堵了好几公里，我们骑车经过拥堵路段，骑在没车的路上，好爽啊。</p>
<p>这个汽车旅馆洗漱都要在屋子外面的，水冰凉。<br>睡之前大家把坏掉的车胎都换了。大家不停吐槽，车胎上面粘的泥里一股马粪味儿。<br>我和政委一屋，拿出了宝具 - 吹风机，开始吹白天被灌湿的登山鞋。<br>效果吗？还是超群的。累了，就睡得好了。</p>
<h2 id="Day-3"><a href="#Day-3" class="headerlink" title="Day 3"></a>Day 3</h2><p>因为今天要赶车，大家还是早起，吃了一点行动食品就出发了。<br>到了一个村子里，发现了卖包子的地方，于是纷纷买包子吃。<br>发现骑车的时候，怎么吃都吃不饱啊。<br>今天的天气，好极了，阳光灿烂。</p>
<p><img src="/uploads/2016-scene9.jpg" alt="scene9"></p>
<p><img src="/uploads/2016-scene10.jpg" alt="scene10"></p>
<p>大家嫌拍照片不过瘾，开始各种拍视频、拍延时，不亦乐乎。</p>
<p>我在前面骑，突然感觉内心迸发出无比力量，蹭蹭蹭。一路冲到了隆化县城火车站。<br>后来听闻某美女骑车走神，冲到了别人的电动三轮车车斗里面 ……</p>
<p><img src="/uploads/2016-selfie1.jpg" alt="selfie1"></p>
<p>[我一个人吃果粒爽，真是太好吃了 ……]</p>
<p>县城汇合后吃了羊蝎子，味道赞赞赞，食材很给力。让我的冲锋衣回去后携带的羊油气息经久不散 ……</p>
<p>吃完大家就去坐车了。火车上的时候我就开始傲娇了，伙伴们换了座位玩桌游，我却不想去，自己一个人坐在一个车厢里。<br>现在想想，很多时候情绪就不受自己控制了，当时有什么好的处理方法吗？</p>
<h2 id="Day-4"><a href="#Day-4" class="headerlink" title="Day 4"></a>Day 4</h2><p>回学校了。</p>
<hr>
<p>一起骑车的小伙伴，有的还要继续在学校几年，有的已经要毕业了。想起你们，还是有些伤感的，在杭州有些孤单。</p>
<p>祝你们顺利。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.formalscience.com/2018/05/02/2018-05-27_2016_%E5%8D%81%E4%B8%80%E5%A1%9E%E7%BD%95%E5%9D%9D%E8%A1%8C%E5%8A%A8/" data-id="ckpoawmgq001bitp93e5qh6jd" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-How-Does-Monero-Work-笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/21/How-Does-Monero-Work-%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2018-01-21T15:46:20.000Z" itemprop="datePublished">2018-01-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF%E8%AE%B0%E5%BD%95/">技术记录</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/21/How-Does-Monero-Work-%E7%AC%94%E8%AE%B0/">‘How Does Monero Work?&#39; 笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Monero 门罗币的一个<a href="https://www.youtube.com/watch?v=cjbHqvr4ffo&list=PL2-dafEMk2A7jW7CYUJsBu58JH27bqaNL" target="_blank" rel="noopener">介绍视频</a></p>
<p>我刚买到 1070Ti 显卡时曾经想要挖过这个币，后来放弃了，觉得没有意义。不过了解这个技术的一些原理还是有价值的。</p>
<hr>
<p>Siraj Raval 的免责声明：<br></p>
<blockquote>
<p>Monero 是一种不可追踪的加密货币，网络上很多非法买卖东西的人会使用它。他介绍这个技术的原因是：你应当对你的数据有控制权，而很多数据是交易数据（transactional data）。目前很多公司可以从中免费挖掘信息，用来预测你的购买行为，以便向你展示广告。理想情况下他们应当为你的数据付费，而他们付费的唯一可能是你控制着数据，而唯一控制数据的方式为数据是匿名的。为了查阅你的交易历史，</p>
</blockquote>
<p><img src="/uploads/monero1.png" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.formalscience.com/2018/01/21/How-Does-Monero-Work-%E7%AC%94%E8%AE%B0/" data-id="ckpoawmha002qitp98coz2fd6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/note/" rel="tag">note</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-两个玻璃球（网上流传的面试题）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/17/%E4%B8%A4%E4%B8%AA%E7%8E%BB%E7%92%83%E7%90%83%EF%BC%88%E7%BD%91%E4%B8%8A%E6%B5%81%E4%BC%A0%E7%9A%84%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%89/" class="article-date">
  <time datetime="2018-01-17T19:57:18.000Z" itemprop="datePublished">2018-01-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF%E8%AE%B0%E5%BD%95/">技术记录</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/17/%E4%B8%A4%E4%B8%AA%E7%8E%BB%E7%92%83%E7%90%83%EF%BC%88%E7%BD%91%E4%B8%8A%E6%B5%81%E4%BC%A0%E7%9A%84%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%89/">两个玻璃球（网上流传的面试题）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>据说这是 Google 的一个面试题：</p>
<blockquote>
<p>有一栋 100 层高的大楼，有两个完全相同的玻璃球。假设从某一层开始丢下玻璃球会摔碎，利用手中的两个玻璃球确定是第几层。最少扔几次玻璃球可以确定这个临界楼层（玻璃球在这一层以及更高的楼层扔下会摔碎）？</p>
</blockquote>
<p>就如孔子说过的那句名言 “I Never Said All That Shit” 一样，这个题目出自哪里我也没有去考证。下面把我的思路整理一下。</p>
<p>如果只有一个玻璃球，能做的就是从 1 层开始尝试扔下玻璃球，然后尝试 2 层、3 层 ……，直到某一层扔下玻璃球后摔碎。而现在有两个玻璃球，我们可以用一个玻璃球从 1 层、11 层、21 层 …… 扔下去，确定一个较小的破碎范围，然后使用第二个玻璃球确定具体的楼层。</p>
<p>假如总共 N 层，我们从第 X 层扔下第一个玻璃球，有两种可能性：玻璃球摔碎或者没碎。如果玻璃球摔碎，说明临界楼层在 1<del>X 中；如果没摔碎，则临界楼层在 X+1</del>N 中。</p>
<p>如果临界楼层在 1~N 中是均匀分布的，那么 $N &gt; 2$ 时确定临界楼层需要扔玻璃球的最少次数可以由以下公式表示：</p>
<p>$$<br>f(N)= \min_{X \in [1, N]} {1 + f(N-X)\frac{N-X}{N} + g(X)\frac{X}{N}}<br>$$</p>
<p>$f(N)$ 为使用两个玻璃球确定区间长度为 N 时的临界楼层所用次数，$g(X)$ 为使用一个玻璃球确定区间长度为 N 时的临界楼层所用次数。这个公式的三部分分别对应：</p>
<ul>
<li>一次扔玻璃球的尝试</li>
<li>玻璃球未摔碎概率$\times$此时继续尝试需要的次数 $f(N-X)$（两个玻璃球）</li>
<li>玻璃球摔碎概率$\times$此时继续尝试需要的次数 $g(X)$（一个玻璃球）。</li>
</ul>
<p>显然有 $f(1)=0$，$g(N)=N-1$。可以用动态规划求解 $N=100$ 时需要的最少次数。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.formalscience.com/2018/01/17/%E4%B8%A4%E4%B8%AA%E7%8E%BB%E7%92%83%E7%90%83%EF%BC%88%E7%BD%91%E4%B8%8A%E6%B5%81%E4%BC%A0%E7%9A%84%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%89/" data-id="ckpoawmhk003pitp9cpv797zu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag">面试题</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Golang-系统调用-Syscall" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/15/Golang-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8-Syscall/" class="article-date">
  <time datetime="2018-01-15T20:59:11.000Z" itemprop="datePublished">2018-01-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF%E8%AE%B0%E5%BD%95/">技术记录</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/15/Golang-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8-Syscall/">Golang 系统调用/Syscall</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>很多和系统相关的函数都需要调用系统 API，例如读写文件的函数。Golang 对一些系统调用接口进行了封装，提供了 Golang 函数让用户调用，例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Read</span><span class="params">(fd <span class="keyword">int</span>, p []<span class="keyword">byte</span>)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Write</span><span class="params">(fd <span class="keyword">int</span>, p []<span class="keyword">byte</span>)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br></pre></td></tr></table></figure>
<p>同时，Golang 也提供了对 Syscall 的直接调用支持：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Syscall</span><span class="params">(trap, a1, a2, a3 <span class="keyword">uintptr</span>)</span> <span class="params">(r1, r2 <span class="keyword">uintptr</span>, err Errno)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Syscall6</span><span class="params">(trap, a1, a2, a3, a4, a5, a6 <span class="keyword">uintptr</span>)</span> <span class="params">(r1, r2 <span class="keyword">uintptr</span>, err Errno)</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">RawSyscall</span><span class="params">(trap, a1, a2, a3 <span class="keyword">uintptr</span>)</span> <span class="params">(r1, r2 <span class="keyword">uintptr</span>, err Errno)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">RawSyscall6</span><span class="params">(trap, a1, a2, a3, a4, a5, a6 <span class="keyword">uintptr</span>)</span> <span class="params">(r1, r2 <span class="keyword">uintptr</span>, err Errno)</span></span></span><br></pre></td></tr></table></figure>
<p><code>RawSyscall</code> 和 <code>RawSyscall6</code> 是对操作系统 Syscall 的直接调用；<code>Syscall</code> 和 <code>Syscall6</code> 会在调用操作系统 Syscall 前调用 <code>runtime·entersyscall</code> ，在操作系统 Syscall 返回后调用 <code>runtime·exitsyscall</code> 。</p>
<p>这四个函数都是使用汇编语言实现，代码和具体的硬件体系结构和操作系统有关。<code>RawSyscall</code> 和 <code>RawSyscall6</code> 的行为和 C 语言中系统调用很类似，在这里不展开描述。而 <code>Syscall</code> 和 <code>Syscall6</code> 的行为（在进行真正的系统调用前后插入额外操作）与 Golang 的调度器关系紧密，在下面会进行要点描述。</p>
<p><code>Syscall</code> 的关键在于 <code>runtime·entersyscall</code> 和 <code>runtime·exitsyscall</code> ，而 <code>runtime·entersyscall</code> 还有一个行为有部分差异的版本 <code>runtime·entersyscallblock</code> 。</p>
<h1 id="runtime·entersyscall"><a href="#runtime·entersyscall" class="headerlink" title="runtime·entersyscall"></a><code>runtime·entersyscall</code></h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">entersyscall</span><span class="params">(dummy <span class="keyword">int32</span>)</span></span> &#123;</span><br><span class="line">	reentersyscall(getcallerpc(), getcallersp(unsafe.Pointer(&amp;dummy)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reentersyscall</span><span class="params">(pc, sp <span class="keyword">uintptr</span>)</span></span> &#123;</span><br><span class="line">	_g_ := getg()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Disable preemption because during this function g is in Gsyscall status,</span></span><br><span class="line">	<span class="comment">// but can have inconsistent g-&gt;sched, do not let GC observe it.</span></span><br><span class="line">	_g_.m.locks++</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Entersyscall must not call any function that might split/grow the stack.</span></span><br><span class="line">	<span class="comment">// (See details in comment above.)</span></span><br><span class="line">	<span class="comment">// Catch calls that might, by replacing the stack guard with something that</span></span><br><span class="line">	<span class="comment">// will trip any stack check and leaving a flag to tell newstack to die.</span></span><br><span class="line">	_g_.stackguard0 = stackPreempt</span><br><span class="line">	_g_.throwsplit = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Leave SP around for GC and traceback.</span></span><br><span class="line">	save(pc, sp)</span><br><span class="line">	_g_.syscallsp = sp</span><br><span class="line">	_g_.syscallpc = pc</span><br><span class="line">	casgstatus(_g_, _Grunning, _Gsyscall)</span><br><span class="line">	<span class="keyword">if</span> _g_.syscallsp &lt; _g_.stack.lo || _g_.stack.hi &lt; _g_.syscallsp &#123;</span><br><span class="line">		systemstack(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">"entersyscall inconsistent "</span>, hex(_g_.syscallsp), <span class="string">" ["</span>, hex(_g_.stack.lo), <span class="string">","</span>, hex(_g_.stack.hi), <span class="string">"]\n"</span>)</span><br><span class="line">			throw(<span class="string">"entersyscall"</span>)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> trace.enabled &#123;</span><br><span class="line">		systemstack(traceGoSysCall)</span><br><span class="line">		<span class="comment">// systemstack itself clobbers g.sched.&#123;pc,sp&#125; and we might</span></span><br><span class="line">		<span class="comment">// need them later when the G is genuinely blocked in a</span></span><br><span class="line">		<span class="comment">// syscall</span></span><br><span class="line">		save(pc, sp)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> atomic.Load(&amp;sched.sysmonwait) != <span class="number">0</span> &#123;</span><br><span class="line">		systemstack(entersyscall_sysmon)</span><br><span class="line">		save(pc, sp)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> _g_.m.p.ptr().runSafePointFn != <span class="number">0</span> &#123;</span><br><span class="line">		<span class="comment">// runSafePointFn may stack split if run on this stack</span></span><br><span class="line">		systemstack(runSafePointFn)</span><br><span class="line">		save(pc, sp)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	_g_.m.syscalltick = _g_.m.p.ptr().syscalltick</span><br><span class="line">	_g_.sysblocktraced = <span class="literal">true</span></span><br><span class="line">	_g_.m.mcache = <span class="literal">nil</span></span><br><span class="line">	_g_.m.p.ptr().m = <span class="number">0</span></span><br><span class="line">	atomic.Store(&amp;_g_.m.p.ptr().status, _Psyscall)</span><br><span class="line">	<span class="keyword">if</span> sched.gcwaiting != <span class="number">0</span> &#123;</span><br><span class="line">		systemstack(entersyscall_gcwait)</span><br><span class="line">		save(pc, sp)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Goroutines must not split stacks in Gsyscall status (it would corrupt g-&gt;sched).</span></span><br><span class="line">	<span class="comment">// We set _StackGuard to StackPreempt so that first split stack check calls morestack.</span></span><br><span class="line">	<span class="comment">// Morestack detects this case and throws.</span></span><br><span class="line">	_g_.stackguard0 = stackPreempt</span><br><span class="line">	_g_.m.locks--</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>runtime·entersyscall</code> 主要完成以下几件事：</p>
<ol>
<li>声明函数为 <code>NOSPLIT</code> ，不触发栈扩展检查</li>
<li>禁止抢占</li>
<li>通过 <code>dummy</code> 参数获得调用者的 <code>SP</code> 和 <code>PC</code> 的值，并保存到 goroutine 的 <code>syscallsp</code> 和 <code>syscallpc</code> 字段。同时记录 <code>syscallstack</code> 和 <code>syscallguard</code> ，使得垃圾回收器只对系统调用前的栈进行 <strong>mark-sweep</strong> （cgo 机制也利用了 <code>entersyscall</code> 来使得 cgo 中运行的代码不受垃圾回收机制管理）。</li>
<li>将 goroutine 的状态切换到 Gsyscall 状态。</li>
<li>唤醒后台线程 <code>sysmon</code> （这个线程会监控执行 <code>syscall</code> 的线程，如果超过某个时间阈值，就会将 M 与对应的 P 解除绑定）。</li>
<li>置空 M 的 <code>mcache</code> 、将 P 的 <code>m</code> 字段，切换 P 的状态到 <code>Psyscall</code> </li>
<li>检查是否需要垃圾回收</li>
<li>通过 <code>g-&gt;stackguard0 = StackPreempt</code> 使得出现 <em>split stack</em> 时可以通过 <code>morestack</code> 捕获并抛出错误</li>
<li>恢复抢占</li>
</ol>
<p>可以看到 <code>reentersyscall</code> 多次调用 <code>save</code> 保存 <code>pc</code> 和 <code>sp</code>。<code>save</code> 更新 <code>getg().sched</code> 中的 <code>sp</code> 和 <code>pc</code> ，使得调用 <code>gogo</code> 的时候可以恢复 <code>pc</code> 和 <code>sp</code> 。<code>reentersyscall</code> 中 <code>save</code> 的目的都是为 goroutine 跳回这个 <code>syscall</code> 调用者执行 <code>syscall</code> 时刻的 <code>pc</code> 和 <code>sp</code>做准备。</p>
<p>需要继续深入：</p>
<ol>
<li><code>StackPreempt</code> </li>
<li><code>syscallstack</code> 和 <code>syscallguard</code> 的具体作用时机</li>
</ol>
<h1 id="runtime·entersyscallblock"><a href="#runtime·entersyscallblock" class="headerlink" title="runtime·entersyscallblock"></a><code>runtime·entersyscallblock</code></h1><p>与 <code>runtime·entersyscall</code> 区别在于这个函数认为当前执行的 <code>syscall</code> 会运行较长时间，因此在函数中主动进行了 M 和 P 的解除绑定，无需等待 <code>sysmon</code> 处理。解除 M 和 P 绑定的逻辑由 <code>entersyscallblock_handoff</code> 实现。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">entersyscallblock_handoff</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> trace.enabled &#123;</span><br><span class="line">		traceGoSysCall()</span><br><span class="line">		traceGoSysBlock(getg().m.p.ptr())</span><br><span class="line">	&#125;</span><br><span class="line">	handoffp(releasep())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="runtime·exitsyscall"><a href="#runtime·exitsyscall" class="headerlink" title="runtime·exitsyscall"></a><code>runtime·exitsyscall</code></h1><p>主要实现了从 <code>syscall</code> 状态中恢复的动作：</p>
<ol>
<li>尝试调用 <code>exitsyscallfast</code> ，如果 M 与 P 没有完全解除绑定，那么该操作会将 M 和 P 重新绑定；否则获取一个空闲的 P 与当前 M 绑定。如果绑定成功，返回 <code>True</code>，否则返回 <code>False</code> 进行后续步骤处理。</li>
<li>如果 <code>exitsyscallfast</code> 返回 <code>True</code> ，函数就直接返回；返回 <code>False</code>，则进入 <em>slow path</em> 将当前 goroutine 放到任务队列中等待调度，具体实现由 <code>mcall(exitsyscall0)</code> 实现。</li>
</ol>
<p><code>exitsyscall0</code> 这个函数比较清晰，只是对其中 <code>dropg()</code> 的目的还没想清楚。</p>
<p><code>runtime·exitsyscall</code> 的函数说明中提到的 <code>// Write barriers are not allowed because our P may have been stolen.</code> 也没有搞清楚，知道和 GC 有一定关系。</p>
<h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><ol>
<li><a href="https://studygolang.com/articles/7005" target="_blank" rel="noopener">https://studygolang.com/articles/7005</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.formalscience.com/2018/01/15/Golang-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8-Syscall/" data-id="ckpoawmh8002jitp9hrui5ke4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Golang-中学到的新东西" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/14/Golang-%E4%B8%AD%E5%AD%A6%E5%88%B0%E7%9A%84%E6%96%B0%E4%B8%9C%E8%A5%BF/" class="article-date">
  <time datetime="2018-01-14T11:53:30.000Z" itemprop="datePublished">2018-01-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF%E8%AE%B0%E5%BD%95/">技术记录</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/14/Golang-%E4%B8%AD%E5%AD%A6%E5%88%B0%E7%9A%84%E6%96%B0%E4%B8%9C%E8%A5%BF/">Golang 中学到的新东西</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><h2 id="string-类型"><a href="#string-类型" class="headerlink" title="string 类型"></a><code>string</code> 类型</h2><p><code>string</code> 类型使用 2 个 word（64 bit 系统为 8 byte * 2）表示：一个 word 是指针，指向字符串存储区域；一个 word 表示长度数据。</p>
<h2 id="slice-leftrightarrow-unsafe-Pointer"><a href="#slice-leftrightarrow-unsafe-Pointer" class="headerlink" title="slice $\leftrightarrow$ unsafe.Pointer"></a><code>slice</code> $\leftrightarrow$ <code>unsafe.Pointer</code></h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">200</span>)</span><br><span class="line">ptr := unsafe.Pointer(&amp;s[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ptr unsafe.Pointer</span><br><span class="line">s := ((*[<span class="number">1</span>&lt;&lt;<span class="number">10</span>]<span class="keyword">byte</span>)(ptr))[:<span class="number">200</span>]</span><br></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ptr unsafe.Pointer</span><br><span class="line"><span class="keyword">var</span> s1 = <span class="keyword">struct</span> &#123;</span><br><span class="line">    addr <span class="keyword">uintptr</span></span><br><span class="line">    <span class="built_in">len</span>  <span class="keyword">int</span></span><br><span class="line">    <span class="built_in">cap</span>  <span class="keyword">int</span></span><br><span class="line">&#125;&#123;ptr, length, length&#125;</span><br><span class="line"></span><br><span class="line">s := *(*[]<span class="keyword">byte</span>)(unsafe.Pointer(&amp;s1))</span><br></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o []<span class="keyword">byte</span></span><br><span class="line">sliceHeader := (*reflect.SliceHeader)((unsafe.Pointer(&amp;o)))</span><br><span class="line">sliceHeader.Cap = length</span><br><span class="line">sliceHeader.Len = length</span><br><span class="line">sliceHeader.Data = <span class="keyword">uintptr</span>(ptr)</span><br></pre></td></tr></table></figure>

<h1 id="map-实现"><a href="#map-实现" class="headerlink" title="map 实现"></a><code>map</code> 实现</h1><p>整个页面的内容对我来说都是新的：<a href="https://tiancaiamao.gitbooks.io/go-internals/content/zh/02.3.html" target="_blank" rel="noopener">https://tiancaiamao.gitbooks.io/go-internals/content/zh/02.3.html</a><br>不过这个页面描述的内容和最新的 Golang source 有一定差别。</p>
<p>读 <code>HashMap</code> 的实现，里面的一些核心关键词：<code>bucket</code>、<code>overflow</code> 让我理解起来有些困难。查询 <code>HashMap</code> 相关的一些资料后有了进一步了解。</p>
<ol>
<li><code>bucket</code> 一般使用某种 <code>array</code> 管理，从 <code>key</code> 经过 <code>hash-function</code> 映射的 <code>hash-value</code>（可能截取一部分，也可以视作 sub-hash，我自己编的）作为 <code>index</code> 直接得到。一个 <code>bucket</code> 中可能包含多个不同的 <code>hash-value</code> ，它们截取那一部分得到的 <code>index</code> 相同。因此 <code>bucket</code> 会用一个数据结构管理这些冲突的值，可能是 <code>linked-list</code> 或者 <code>tree-map</code> 之类的。这些内部的数据结构中的 <code>node</code> 存储着真正对应 <code>map</code> 的 <code>key\value</code> 对(pair)。</li>
<li>如果 <code>bucket</code> 太满了，比如元素的数量超过 <code>bucket</code> 数量一定倍数（<code>load factor</code>），则会进行扩容，所有元素都被 <code>rehashed</code> 到一个新的值。</li>
<li>采用这种方式实现 <code>HashMap</code>，<code>bucket</code> 可以有两种选择：<ul>
<li><strong>Direct chaining</strong> 只存一个指向冲突元素集合的 <code>header</code> </li>
<li><strong>Seperate Chaining</strong> 在 <code>bucket</code> 存一部分（一个）元素集合（Golang <code>HashMap</code> 实现里放了 8 个），和一个指向剩下冲突元素集合的 <code>header</code></li>
</ul>
</li>
<li>上面 <code>header</code> 指向的元素集合叫 <code>overflow list</code> 或者 <code>overflow some-other-data-structure</code></li>
</ol>
<p>有了这些背景后，看代码应该会比较清晰了。</p>
<p>目前 Golang 中的 <code>bucket</code> 是为 <code>insert</code> 操作优化的，找到第一个空余位置就可以插入，但是删除的时候要把所有相同 <code>key</code> 的元素都删掉，要遍历 <code>bucket</code> 的 <code>overflow</code> 集合。</p>
<p>如果 key 或者 value 小于 128 字节，那么它们是直接在 <code>bucket</code> 存储值，否则存指向数据的指针。</p>
<h1 id="nil-语义"><a href="#nil-语义" class="headerlink" title="nil 语义"></a><code>nil</code> 语义</h1><p>按照 Golang 规范，任何类型在未初始化时都对应一个零值：</p>
<ul>
<li><code>bool</code> $\rightarrow$ <code>true</code></li>
<li><code>integer</code> $\rightarrow$ <code>0</code></li>
<li><code>string</code> $\rightarrow$ <code>&quot;&quot;</code></li>
<li><code>pointer</code>/<code>function</code>/<code>interface</code>/<code>slice</code>/<code>channel</code>/<code>map</code> $\rightarrow$ <code>nil</code></li>
</ul>
<h2 id="关于-interface"><a href="#关于-interface" class="headerlink" title="关于 interface{}"></a>关于 <code>interface{}</code></h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v *T           <span class="comment">// v == nil</span></span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">interface</span>&#123;&#125;  <span class="comment">// i == nil</span></span><br><span class="line">i = v              <span class="comment">// i != nil</span></span><br></pre></td></tr></table></figure>

<h2 id="关于-channel"><a href="#关于-channel" class="headerlink" title="关于 channel"></a>关于 <code>channel</code></h2><p>一些操作规则：</p>
<ul>
<li>读写一个 <code>nil</code> 的 <code>channel</code> 会立即阻塞</li>
<li>读一个关闭的 <code>channel</code> 会立刻返回一个 <code>channel</code> 元素类型的零值，即 <code>chan int</code> 会返回 <code>0</code></li>
<li>写一个关闭的 <code>channel</code> 会导致 <code>panic</code></li>
</ul>
<h1 id="函数调用"><a href="#函数调用" class="headerlink" title="函数调用"></a>函数调用</h1><h2 id="汇编"><a href="#汇编" class="headerlink" title="汇编"></a>汇编</h2><p>可以看一下这个 Golang 的官方介绍页面：<a href="https://golang.org/doc/asm" target="_blank" rel="noopener">https://golang.org/doc/asm</a></p>
<p><strong>add.go</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> add</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(a, b <span class="keyword">uint64</span>)</span> <span class="title">uint64</span></span></span><br></pre></td></tr></table></figure>

<p><strong>add_amd64.s</strong> 或使用其他平台后缀，和 <strong>add.go</strong> 在同一个目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">TEXT    ·Add+0(SB),$0-24</span><br><span class="line">MOVQ    a+0(FP),BX</span><br><span class="line">MOVQ    b+8(FP),BP</span><br><span class="line">ADDQ    BP,BX</span><br><span class="line">MOVQ    BX,res+16(FP)</span><br><span class="line">RET     ,</span><br></pre></td></tr></table></figure>

<h2 id="Golang-调用-C"><a href="#Golang-调用-C" class="headerlink" title="Golang 调用 C"></a>Golang 调用 C</h2><p><strong>add.c</strong> ，和 <strong>add.go</strong> 在同一个目录</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> ·Add(uint64 a, uint64 b, uint64 ret) &#123;</span><br><span class="line">    ret = a + b;</span><br><span class="line">    FLUSH(&amp;ret);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译这个包：<code>go install add</code></p>
<p>C 文件中需要包含 <code>runtime.h</code> 头文件。因为 Golang 使用特殊寄存器存放像全局 <code>struct G</code> 和 <code>struct M</code> ，包含这个文件可以让所有链接到 Go 的 C 文件感知这一点，避免编译器使用这些特定的寄存器做其他用途。</p>
<p>上面示例中返回值为空，使用 <code>ret</code> 作为返回值，<code>FLUSH</code> 在 <code>pkg/runtime/runtime.h</code> 中定义为 <code>USED()</code> ，防止编译器优化掉对某个变量的赋值操作（因为看不到这个变量在后面其他地方使用了）。</p>
<h2 id="函数调用时的内存布局"><a href="#函数调用时的内存布局" class="headerlink" title="函数调用时的内存布局"></a>函数调用时的内存布局</h2><p>Golang 中使用的 C 编译器是 plan9 的 C 编译器，与 gcc 有一定差异。<br>这个页面中有部分基础介绍：<br><a href="https://tiancaiamao.gitbooks.io/go-internals/content/zh/03.1.html" target="_blank" rel="noopener">https://tiancaiamao.gitbooks.io/go-internals/content/zh/03.1.html</a></p>
<p>如果返回多个值，<code>func f(a, b int) (d, e int)</code> 内存布局如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">slot for e</span><br><span class="line">slot for d</span><br><span class="line">b</span><br><span class="line">a </span><br><span class="line">&lt;- SP</span><br></pre></td></tr></table></figure>
<p>调用后为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">slot for e</span><br><span class="line">slot for d</span><br><span class="line">b</span><br><span class="line">a &lt;- FP</span><br><span class="line">PC &lt;- SP</span><br><span class="line">f&#39;s stack</span><br></pre></td></tr></table></figure>

<p>plan9 的 C 汇编器对被调用函数的参数值的修改是会返回到调用函数中的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MOVQ    BX,d+16(FP)</span><br><span class="line">...</span><br><span class="line">MOVQ    BX,e+24(FP)</span><br></pre></td></tr></table></figure>

<h1 id="go-关键字"><a href="#go-关键字" class="headerlink" title="go 关键字"></a><code>go</code> 关键字</h1><p><code>f(1, 2, 3)</code> 的汇编:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MOVL    $1, 0(SP)</span><br><span class="line">MOVL    $2, 4(SP)</span><br><span class="line">MOVL    $3, 8(SP)</span><br><span class="line">CALL    f(SB)</span><br></pre></td></tr></table></figure>

<p><code>go f(1, 2, 3)</code> 的汇编：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MOVL    $1, 0(SP)</span><br><span class="line">MOVL    $2, 4(SP)</span><br><span class="line">MOVL    $3, 8(SP)</span><br><span class="line">PUSHQ   $f(SB)</span><br><span class="line">PUSHQ   $12</span><br><span class="line">CALL    runtime.newproc(SB)</span><br><span class="line">POPQ    AX</span><br><span class="line">POPQ    AX</span><br></pre></td></tr></table></figure>

<p><code>12</code> 是参数占用的大小，<code>runtime.newproc</code> 函数接受的参数为：参数大小、新的 goroutine 要运行的函数、函数的参数。<code>runtime.newproc</code> 会新建一个栈空间，将栈参数的 12 个字节复制到新的栈空间，并让栈指针指向参数。可以看做 <code>runtime.newproc(size, f, args)</code> 。</p>
<h1 id="defer-关键字"><a href="#defer-关键字" class="headerlink" title="defer 关键字"></a><code>defer</code> 关键字</h1><p><code>return x</code> 不是原子语句，函数执行顺序为：</p>
<ol>
<li>给返回值赋值</li>
<li><code>defer</code> 调用</li>
<li><code>return</code></li>
</ol>
<p><code>defer</code> 实现对应 <code>runtime.deferproc</code>，其出现的地方插入指令 <code>call runtime.deferproc</code> ，函数返回之前的地方，插入 <code>call runtime.deferreturn</code> 。 goroutine 的控制结构中有一张表记录 <code>defer</code>，表以栈行为运作。</p>
<h1 id="Continuous-Stack"><a href="#Continuous-Stack" class="headerlink" title="Continuous Stack"></a>Continuous Stack</h1><p>我也基本理解了思路，具体细节可以看：<a href="https://tiancaiamao.gitbooks.io/go-internals/content/zh/03.5.html" target="_blank" rel="noopener">https://tiancaiamao.gitbooks.io/go-internals/content/zh/03.5.html</a></p>
<p>最后的 <code>runtime.lessstack</code> 有些没看懂。</p>
<h1 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h1><p>闭包中引用的变量不能在栈上分配，否则闭包函数返回的时候，栈上变量的地址就失效了。</p>
<h2 id="逃逸分析（escape-analyze）"><a href="#逃逸分析（escape-analyze）" class="headerlink" title="逃逸分析（escape analyze）"></a>逃逸分析（escape analyze）</h2><p>Golang 有个特性，可以自动识别哪些变量在栈上分配，哪些在堆上分配。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">()</span> *<span class="title">Cursor</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> c Cursor</span><br><span class="line">    c.X = <span class="number">500</span></span><br><span class="line">    noinline()</span><br><span class="line">    <span class="keyword">return</span> &amp;c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MOVQ      $type.&quot;&quot;.Cursor+0(SB),(SP)    &#x2F;&#x2F; 取变量c的类型，也就是Cursor</span><br><span class="line">PCDATA    $0,$16</span><br><span class="line">PCDATA    $1,$0</span><br><span class="line">CALL      ,runtime.new(SB)    &#x2F;&#x2F; 调用new函数，相当于new(Cursor)</span><br><span class="line">PCDATA    $0,$-1</span><br><span class="line">MOVQ      8(SP),AX    &#x2F;&#x2F; 取c.X的地址放到AX寄存器</span><br><span class="line">MOVQ      $500,(AX)    &#x2F;&#x2F; 将AX存放的内存地址的值赋为500</span><br><span class="line">MOVQ      AX,&quot;&quot;.~r0+24(FP)</span><br><span class="line">ADDQ      $16,SP</span><br></pre></td></tr></table></figure>

<p>在编译的过程中可以通过指令输出哪些变量逃逸了：<code>go build --gcflags=-m main.go</code></p>
<h2 id="闭包结构体"><a href="#闭包结构体" class="headerlink" title="闭包结构体"></a>闭包结构体</h2><p>闭包将函数和它引用的环境表示为一个结构体：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Closure <span class="keyword">struct</span> &#123;</span><br><span class="line">    F <span class="function"><span class="keyword">func</span><span class="params">()</span><span class="params">()</span></span> </span><br><span class="line">    i *<span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>整体思路是返回闭包的时候，返回一个结构体，包含闭包返回函数的地址和引用的环境中的变量地址。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">        i++</span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">MOVQ    $type.int+0(SB),(SP)</span><br><span class="line">PCDATA    $0,$16</span><br><span class="line">PCDATA    $1,$0</span><br><span class="line">CALL    ,runtime.new(SB)    &#x2F;&#x2F; 是不是很熟悉，这一段就是i &#x3D; new(int)    </span><br><span class="line">...    </span><br><span class="line">MOVQ    $type.struct &#123; F uintptr; A0 *int &#125;+0(SB),(SP)    &#x2F;&#x2F; 这个结构体就是闭包的类型</span><br><span class="line">...</span><br><span class="line">CALL    ,runtime.new(SB)    &#x2F;&#x2F; 接下来相当于 new(Closure)</span><br><span class="line">PCDATA    $0,$-1</span><br><span class="line">MOVQ    8(SP),AX</span><br><span class="line">NOP    ,</span><br><span class="line">MOVQ    $&quot;&quot;.func·001+0(SB),BP</span><br><span class="line">MOVQ    BP,(AX)                &#x2F;&#x2F; 函数地址赋值给Closure的F部分</span><br><span class="line">NOP    ,</span><br><span class="line">MOVQ    &quot;&quot;.&amp;i+16(SP),BP        &#x2F;&#x2F; 将堆中new的变量i的地址赋值给Closure的值部分</span><br><span class="line">MOVQ    BP,8(AX)</span><br><span class="line">MOVQ    AX,&quot;&quot;.~r1+40(FP)</span><br><span class="line">ADDQ    $24,SP</span><br><span class="line">RET    ,</span><br></pre></td></tr></table></figure>

<h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><ol>
<li><a href="https://tiancaiamao.gitbooks.io/go-internals" target="_blank" rel="noopener">https://tiancaiamao.gitbooks.io/go-internals</a></li>
<li><a href="http://gki.informatik.uni-freiburg.de/teaching/ss11/theoryI/07_Hashing_Chaining.pdf" target="_blank" rel="noopener">http://gki.informatik.uni-freiburg.de/teaching/ss11/theoryI/07_Hashing_Chaining.pdf</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.formalscience.com/2018/01/14/Golang-%E4%B8%AD%E5%AD%A6%E5%88%B0%E7%9A%84%E6%96%B0%E4%B8%9C%E8%A5%BF/" data-id="ckpoawmh7002hitp9axox0x30" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-使用-Nvidia-显卡加速机器学习算法的一些资料" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/13/%E4%BD%BF%E7%94%A8-Nvidia-%E6%98%BE%E5%8D%A1%E5%8A%A0%E9%80%9F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95%E7%9A%84%E4%B8%80%E4%BA%9B%E8%B5%84%E6%96%99/" class="article-date">
  <time datetime="2018-01-13T13:14:09.000Z" itemprop="datePublished">2018-01-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF%E8%AE%B0%E5%BD%95/">技术记录</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/13/%E4%BD%BF%E7%94%A8-Nvidia-%E6%98%BE%E5%8D%A1%E5%8A%A0%E9%80%9F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95%E7%9A%84%E4%B8%80%E4%BA%9B%E8%B5%84%E6%96%99/">使用 Nvidia 显卡加速机器学习算法的一些资料</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Nnidia 显卡可以用来加速机器学习算法（特别是深度学习），但安装驱动过程中总会碰到这样或者那样的问题。<br>一个难点是安装库的时候没有下载链接，比如 Nvidia 的 Cuda/cuDNN 主页经常会出现这样的提示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NVIDIA Developer Site is under going maintenance.</span><br><span class="line">      The site will be back by shortly.</span><br><span class="line">      We apologize for any inconvenience.</span><br></pre></td></tr></table></figure>
<p>虽然不能按照官方路径进行下载，但经过搜索总能找到一些入口。下面是我收集的一些链接：</p>
<ul>
<li>cuDNN <ul>
<li>下载页面：<a href="https://developer.nvidia.com/rdp/cudnn-download" target="_blank" rel="noopener">https://developer.nvidia.com/rdp/cudnn-download</a> </li>
<li>这个页面需要注册 Nvidia 开发者账号并登录，当前包含从 <code>cuDNN v5.1</code> 到 <code>cuDNN 7.0.5</code> 的版本</li>
</ul>
</li>
<li>CUDA<ul>
<li>下载页面：<a href="https://developer.nvidia.com/cuda-toolkit-archive" target="_blank" rel="noopener">https://developer.nvidia.com/cuda-toolkit-archive</a></li>
<li>这个页面需要注册 Nvidia 开发者账号并登录，当前包含从 <code>CUDA Toolkit 1.0</code> 到 <code>CUDA Toolkit 9.0</code> 的版本，最新的 <code>CUDA Toolkit 9.1</code> 的链接仍然指向<em>正在维护</em>的提示页面</li>
<li>Ubuntu 16.04 <code>CUDA Toolkit 9.1</code> 下载链接：<a href="http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1604/x86_64/cuda-repo-ubuntu1604_9.1.85-1_amd64.deb" target="_blank" rel="noopener">http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1604/x86_64/cuda-repo-ubuntu1604_9.1.85-1_amd64.deb</a> </li>
<li>此外可以在这个页面找到其他 Linux 发行版的安装包：<a href="http://developer.download.nvidia.com/compute/cuda/repos/" target="_blank" rel="noopener">http://developer.download.nvidia.com/compute/cuda/repos/</a></li>
<li>Windows 10 版本的 <code>CUDA Toolkit 9.1</code> 我成功下载过一次，但是和当前的 <code>TensorFlow 1.4</code> 不兼容，刚才发现之前组合出来的下载链接无效了。如果找到链接会补充上。当前可用 <code>cuDNN v6.1</code> 和 <code>CUDA Toolkit 8.0 GA2</code> 版本。</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.formalscience.com/2018/01/13/%E4%BD%BF%E7%94%A8-Nvidia-%E6%98%BE%E5%8D%A1%E5%8A%A0%E9%80%9F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95%E7%9A%84%E4%B8%80%E4%BA%9B%E8%B5%84%E6%96%99/" data-id="ckpoawmhp0042itp98rnw821h" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-一些有趣的项目_Protocol_Labs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/12/%E4%B8%80%E4%BA%9B%E6%9C%89%E8%B6%A3%E7%9A%84%E9%A1%B9%E7%9B%AE_Protocol_Labs/" class="article-date">
  <time datetime="2018-01-12T21:37:21.000Z" itemprop="datePublished">2018-01-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF%E8%AE%B0%E5%BD%95/">技术记录</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/12/%E4%B8%80%E4%BA%9B%E6%9C%89%E8%B6%A3%E7%9A%84%E9%A1%B9%E7%9B%AE_Protocol_Labs/">一些有趣的项目 Protocol Labs</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最初在 3Blue1Brown 发布的一个介绍区块链原理的视频中看到了这个组织的连接。发现比较有意思，给大家分享一下~</p>
<p>项目的使命：</p>
<blockquote>
<p>We believe the internet has become humanity’s most important technology. We build protocols, systems, and tools to improve how it works. Today, we are focused on how we store, locate, and move information.</p>
</blockquote>
<blockquote>
<p>我们相信互联网已成为人类最重要的技术。我们构建提升互联网工作能力的协议、系统和工具。当前我们集中在如何存储、定位和移动信息的工作上。</p>
</blockquote>
<p>这段文字翻译得有点机器翻译风格。</p>
<p>项目地址：<a href="https://protocol.ai/projects/" target="_blank" rel="noopener">https://protocol.ai/projects/</a> ，目前上面有 5 个项目：</p>
<ol>
<li><strong>Filecoin</strong><ul>
<li>加密货币，Miners 通过向网络提供存储空间来获取 <code>Filecoin</code> ，使用者通过消耗 <code>Filecoin</code> 来在<strong>去中心化的</strong>网络中存储加密后的文件。</li>
</ul>
</li>
<li><strong>IPFS</strong> (InterPlanetary File System)<ul>
<li>一种新型协议，用来使网络去中心化。IPFS 通过内容寻址和数字签名来创建完全去中心化和分布式的应用。IPFS 使得网络更快、更安全以及更加开放。</li>
<li>这是一段 YouTube 上的介绍视频：<a href="https://www.youtube.com/watch?v=8CMxDNuuAiQ" target="_blank" rel="noopener">https://www.youtube.com/watch?v=8CMxDNuuAiQ</a> ，介绍了 IPFS 的一些基本使用方法。根据我的理解，这是通过 content-address（immutable hash） 访问的分布式加密文件系统，可以通过命令行、网页界面等多种方式进行访问，有点类似 Samba，不过是分布式的。Siraj Raval 制作的一个视频：<a href="https://www.youtube.com/watch?v=BA2rHlbB5i0" target="_blank" rel="noopener">https://www.youtube.com/watch?v=BA2rHlbB5i0</a> ，也对 IPFS 进行了介绍，主要对 <strong>Why</strong> 的部分进行阐述。<ul>
<li>带宽，多个客户端对中心节点访问</li>
<li>延迟</li>
<li>弹性 Resiliency，中心节点失效（网络断开或者数据删除）后无法进行数据访问</li>
<li>中心化 Centralization，主流网站掌控所有数据，用户无从得知数据的使用方式，此外会受到政府或者其他势力的干扰。</li>
</ul>
</li>
<li>使用的技术：Chord、DHT、bit swap(bittorrent mechanism)、MerkleDAG</li>
</ul>
</li>
<li><strong>Libp2p</strong><ul>
<li>一个模块化的网络栈，把一系列传输协议和 peer-to-peer 协议整合在一起，方便开发者构建大型、健壮的 p2p 网络</li>
</ul>
</li>
<li><strong>IPLD</strong><ul>
<li>去中心化网络（content-addressable web）的数据模型，它通过加密哈希值的方式连接了所有数据，使得数据的遍历和彼此链接更加容易。网站的示意图中连接了 bitcoin、以太坊、IPFS、Git Repo 等。</li>
</ul>
</li>
<li><strong>Multiformats</strong><ul>
<li>这个项目是面向未来验证系统（future-proof systems）的协议集合， 自描述的格式可以让你的系统可以互操作和具有可升级性。</li>
</ul>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.formalscience.com/2018/01/12/%E4%B8%80%E4%BA%9B%E6%9C%89%E8%B6%A3%E7%9A%84%E9%A1%B9%E7%9B%AE_Protocol_Labs/" data-id="ckpoawmhh003fitp96dx536n6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/note/" rel="tag">note</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/3/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9B%9E%E5%BF%86%E4%B8%AD%E8%80%81%E5%8E%BB/">回忆中老去</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9B%9E%E5%BF%86%E4%B8%AD%E8%80%81%E5%8E%BB/%E6%84%9F%E6%82%9F/">感悟</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%87%E5%AE%99%E5%B0%8F%E7%99%BE%E7%A7%91/">宇宙小百科</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B1%B1%E9%87%8E/">山野</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E8%AE%B0%E5%BD%95/">技术记录</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E8%AE%B0%E5%BD%95/tech-notes/">tech-notes</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%85%E8%A1%8C/">旅行</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%A7%82%E7%82%B9/">观点</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%A7%84%E5%88%92/">规划</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AF%97%E6%AD%8C/">诗歌</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AF%97%E6%AD%8C%E7%9A%84%E6%B5%B7%E6%B4%8B/">诗歌的海洋</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AF%BB%E4%B9%A6%E8%A7%82%E5%BD%B1/">读书观影</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Functional-Programming/" rel="tag">Functional Programming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Haskell/" rel="tag">Haskell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Travel/" rel="tag">Travel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang/" rel="tag">golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/note/" rel="tag">note</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/programming-language/" rel="tag">programming language</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E8%AF%AD%E8%A8%80/" rel="tag">函数式语言</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%9F%E6%B4%BB/" rel="tag">生活</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%A7%84%E5%88%92/" rel="tag">规划</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag">面试题</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Functional-Programming/" style="font-size: 10px;">Functional Programming</a> <a href="/tags/Golang/" style="font-size: 20px;">Golang</a> <a href="/tags/Haskell/" style="font-size: 10px;">Haskell</a> <a href="/tags/Rust/" style="font-size: 10px;">Rust</a> <a href="/tags/Travel/" style="font-size: 15px;">Travel</a> <a href="/tags/golang/" style="font-size: 20px;">golang</a> <a href="/tags/note/" style="font-size: 15px;">note</a> <a href="/tags/programming-language/" style="font-size: 15px;">programming language</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E8%AF%AD%E8%A8%80/" style="font-size: 10px;">函数式语言</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 10px;">生活</a> <a href="/tags/%E8%A7%84%E5%88%92/" style="font-size: 10px;">规划</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 10px;">面试题</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">September 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">May 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">November 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">April 2012</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/01/01/2020-guidelines/">2020 生活规划</a>
          </li>
        
          <li>
            <a href="/2019/08/24/2019-09-24-Rent-in-Edinburgh/">爱丁堡租房</a>
          </li>
        
          <li>
            <a href="/2019/02/17/2019-02-17_To_Bangkok/">To Bangkok</a>
          </li>
        
          <li>
            <a href="/2018/12/26/2018-12-26-Go-to-Rust/">Go to Rust （一）</a>
          </li>
        
          <li>
            <a href="/2018/12/13/2018-12-13-pip-install-package-offline/">pip 离线安装包</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Bef0rewind<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>