<!doctype html><html lang=en><head><title>函数式语言课程期末考试判卷中遇到的一个问题 :: 不是追风少年</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="在使用半自动化 Judge 系统对同学的答题进行评测的时候，遇到了一个奇怪的问题，总是会提示: Test_1: output.txt: openFile: resource busy (file is locked)
起初以为是 haskell 惰性求值导致的 IO 问题，因为搜索引擎也把猜测引导向这个原因，但是始终解决不了。
后来改变了思路，“现在看来好像是模块引入带来的 main 函数重名问题”，这是后面的猜疑。
继而发现将函数改名字也解决不了问题，实际也不是，就是 IO 的问题。因为如果先移除 output.txt， 那么使用 ghc 执行就不会出现之前的错误提示，不过在 ghci 中执行总是不会出错。
使用如下代码测试一下：
dir = &amp;quot;/home/user-name/Downloads/auto_check/work/2015final/ref/tests/words&amp;quot; main :: IO () main = do print &amp;quot;hehe&amp;quot; solution = runTest (map (\f -&amp;amp;gt; combine dir f) [&amp;quot;input1-1.txt&amp;quot;, &amp;quot;input1-2.txt&amp;quot;, &amp;quot;input1-3.txt&amp;quot;]) (combine dir &amp;quot;output1.txt&amp;quot;) `&amp;lt;/pre&amp;gt; 执行得到如下结果： &amp;lt;pre&amp;gt;`➜ test ghci Test_1.hs GHCi, version 7.8.4: http://www.haskell.org/ghc/ :? for help Loading package ghc-prim ."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://blog.formalscience.com/2016/02/03/2016-02-03_%E5%87%BD%E6%95%B0%E5%BC%8F%E8%AF%AD%E8%A8%80%E8%AF%BE%E7%A8%8B%E6%9C%9F%E6%9C%AB%E8%80%83%E8%AF%95%E5%88%A4%E5%8D%B7%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98/><link rel=stylesheet href=https://blog.formalscience.com/assets/style.css><link rel=stylesheet href=assets/%25!s%28%3cnil%3e%29.css><link rel=apple-touch-icon href=https://blog.formalscience.com/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://blog.formalscience.com/img/favicon/orange.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="函数式语言课程期末考试判卷中遇到的一个问题"><meta property="og:description" content="在使用半自动化 Judge 系统对同学的答题进行评测的时候，遇到了一个奇怪的问题，总是会提示: Test_1: output.txt: openFile: resource busy (file is locked)
起初以为是 haskell 惰性求值导致的 IO 问题，因为搜索引擎也把猜测引导向这个原因，但是始终解决不了。
后来改变了思路，“现在看来好像是模块引入带来的 main 函数重名问题”，这是后面的猜疑。
继而发现将函数改名字也解决不了问题，实际也不是，就是 IO 的问题。因为如果先移除 output.txt， 那么使用 ghc 执行就不会出现之前的错误提示，不过在 ghci 中执行总是不会出错。
使用如下代码测试一下：
dir = &amp;quot;/home/user-name/Downloads/auto_check/work/2015final/ref/tests/words&amp;quot; main :: IO () main = do print &amp;quot;hehe&amp;quot; solution = runTest (map (\f -&amp;amp;gt; combine dir f) [&amp;quot;input1-1.txt&amp;quot;, &amp;quot;input1-2.txt&amp;quot;, &amp;quot;input1-3.txt&amp;quot;]) (combine dir &amp;quot;output1.txt&amp;quot;) `&amp;lt;/pre&amp;gt; 执行得到如下结果： &amp;lt;pre&amp;gt;`➜ test ghci Test_1.hs GHCi, version 7.8.4: http://www.haskell.org/ghc/ :? for help Loading package ghc-prim ."><meta property="og:url" content="https://blog.formalscience.com/2016/02/03/2016-02-03_%E5%87%BD%E6%95%B0%E5%BC%8F%E8%AF%AD%E8%A8%80%E8%AF%BE%E7%A8%8B%E6%9C%9F%E6%9C%AB%E8%80%83%E8%AF%95%E5%88%A4%E5%8D%B7%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98/"><meta property="og:site_name" content="不是追风少年"><meta property="og:image" content="img/favicon/%!s().png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:section" content="技术记录"><meta property="article:published_time" content="2016-02-03 00:00:00 +0000 UTC"></head><body><div class="container headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=https://blog.formalscience.com/><div class=logo>Terminal</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/>Home</a></li><li><a href=/tags/>Tags</a></li><li><a href=/about/>About</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/>Home</a></li><li><a href=/tags/>Tags</a></li><li><a href=/about/>About</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://blog.formalscience.com/2016/02/03/2016-02-03_%E5%87%BD%E6%95%B0%E5%BC%8F%E8%AF%AD%E8%A8%80%E8%AF%BE%E7%A8%8B%E6%9C%9F%E6%9C%AB%E8%80%83%E8%AF%95%E5%88%A4%E5%8D%B7%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98/>函数式语言课程期末考试判卷中遇到的一个问题</a></h1><div class=post-meta><span class=post-date>2016-02-03</span></div><div class=post-content><div><p>在使用半自动化 Judge 系统对同学的答题进行评测的时候，遇到了一个奇怪的问题，总是会提示:
<code>Test_1: output.txt: openFile: resource busy (file is locked)</code></p><hr><p>起初以为是 haskell 惰性求值导致的 IO 问题，因为搜索引擎也把猜测引导向这个原因，但是始终解决不了。</p><hr><p>后来改变了思路，“现在看来好像是模块引入带来的 main 函数重名问题”，这是后面的猜疑。</p><hr><p>继而发现将函数改名字也解决不了问题，实际也不是，就是 IO 的问题。因为如果先移除 output.txt， 那么使用 ghc 执行就不会出现之前的错误提示，不过在 ghci 中执行总是不会出错。</p><p>使用如下代码测试一下：</p><pre><code>dir = &quot;/home/user-name/Downloads/auto_check/work/2015final/ref/tests/words&quot;

main :: IO ()
main = do print &quot;hehe&quot;
solution = runTest
         (map (\f -&amp;gt; combine dir f) [&quot;input1-1.txt&quot;, &quot;input1-2.txt&quot;, &quot;input1-3.txt&quot;])
         (combine dir &quot;output1.txt&quot;)
`&lt;/pre&gt;

执行得到如下结果：

&lt;pre&gt;`➜  test  ghci Test_1.hs
GHCi, version 7.8.4: http://www.haskell.org/ghc/  :? for help
Loading package ghc-prim ... linking ... done.
Loading package integer-gmp ... linking ... done.
Loading package base ... linking ... done.
[1 of 3] Compiling Main             ( Main.hs, interpreted )
[2 of 3] Compiling FileBasedTest    ( FileBasedTest.hs, interpreted )
[3 of 3] Compiling Test             ( Test_1.hs, interpreted )
Ok, modules loaded: Test, FileBasedTest, Main.
*Test&amp;gt; main
Loading package array-0.5.0.0 ... linking ... done.
Loading package deepseq-1.3.0.2 ... linking ... done.
Loading package old-locale-1.0.0.6 ... linking ... done.
Loading package time-1.4.2 ... linking ... done.
Loading package bytestring-0.10.4.0 ... linking ... done.
Loading package unix-2.7.0.1 ... linking ... done.
Loading package filepath-1.3.0.2 ... linking ... done.
Loading package directory-1.2.1.0 ... linking ... done.
&quot;hehe&quot;
*Test&amp;gt; 
Leaving GHCi.
➜  test  rm Test_1.hi
➜  test  ghc Test_1.hs -o Test_1
[3 of 3] Compiling Test             ( Test_1.hs, Test_1.o )
Linking Test_1 ...
➜  test  ./Test_1 
Test_1: output.txt: openFile: resource busy (file is locked)
➜  test  
</code></pre><p>可以看到直接执行 ghc 编译得到的二进制文件就会出现问题，而在 ghci 中就不会。</p><hr><p>经过了一些过程之后终于修复，根本原因是，整个项目的程序入口是 test01.hs 中 Test 模块的 main 函数，而引入了同学实现的代码中的 Main 模块，导致 ghc 编译的时候使用 Main 模块中的 main 函数作为入口。最后通过指定那个模块中的 main 函数作为入口解决：
<code>ghc -main-is Test.main Test_1.hs -o Test_1</code></p></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2022 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://blog.formalscience.com/assets/main.js></script>
<script src=https://blog.formalscience.com/assets/prism.js></script></div></body></html>